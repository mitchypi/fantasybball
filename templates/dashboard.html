<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fantasy Simulator Dashboard</title>
    <link rel="stylesheet" href="/static/css/base.css" />
    <link rel="stylesheet" href="/static/css/setup.css" />
    <link rel="stylesheet" href="/static/css/scoreboard.css" />
    <link rel="stylesheet" href="/static/css/fantasy.css" />
    <link rel="stylesheet" href="/static/css/modal.css" />
</head>
<body data-mode="{{ mode or 'standard' }}">
    <header class="top-bar">
        <div class="brand">
            <h1>Fantasy Replay</h1>
            <span class="season">Season: {{ season }}</span>
        </div>
        <nav class="nav-actions">
            <button id="nav-menu" class="hidden">Menu</button>
            <button id="simulate-day" class="hidden">Simulate Next Day</button>
            <button id="reset-league" class="hidden">Reset League</button>
        </nav>
    </header>

    <main class="dashboard-main">
        <section class="panel{% if (mode or 'standard') == 'gambling' %} hidden{% endif %}" id="setup-panel">
            <h2>League Menu</h2>

            <div class="existing-leagues">
                <h3>Existing Leagues</h3>
                <ul id="league-list" class="league-list"></ul>
                <div class="existing-leagues__actions">
                    <button type="button" id="delete-all-leagues" class="btn-league-delete">Delete All Leagues</button>
                </div>
            </div>

            <h3>Create a New League</h3>
            <form id="scoring-form">
                <label for="scoring-select">Scoring Preset</label>
                <select id="scoring-select"></select>

                <div class="weights-editor" id="weights-editor"></div>

                <label class="checkbox">
                    <input type="checkbox" id="make-default" name="make_default" />
                    <span>Make default profile</span>
                </label>

                <div class="profile-actions">
                    <button type="submit" id="save-profile">Save Preset As</button>
                    <button type="button" id="delete-profile" class="btn-league-delete">Delete Preset</button>
                </div>

                <fieldset class="league-settings">
                    <legend>League Settings</legend>
                    <label for="league-name">League Name</label>
                    <input type="text" id="league-name" name="league_name" placeholder="My Fantasy League" />

                    <label for="team-count">Number of Teams</label>
                    <input type="number" id="team-count" name="team_count" min="2" value="12" />

                    <label for="roster-size">Roster Size</label>
                    <input type="number" id="roster-size" name="roster_size" min="1" value="13" />

                    <label for="team-name">Your Team Name</label>
                    <div class="team-name-row">
                        <input type="text" id="team-name" name="team_name" placeholder="My Championship Squad" />
                        <button type="button" id="suggest-team-name">Suggest Name</button>
                    </div>
                </fieldset>

                <fieldset class="playoff-settings">
                    <legend>Playoffs</legend>
                    <label class="checkbox">
                        <input type="checkbox" id="playoffs-enabled" />
                        <span>Enable playoffs</span>
                    </label>
                    <div id="playoff-controls" class="playoff-controls hidden">
                        <label for="playoffs-team-count">Teams</label>
                        <select id="playoffs-team-count"></select>

                        <label for="playoffs-week-range">Week Window</label>
                        <select id="playoffs-week-range"></select>

                        <label class="checkbox">
                            <input type="checkbox" id="playoffs-reseed" />
                            <span>Reseed each round</span>
                        </label>

                        <label class="checkbox">
                            <input type="checkbox" id="playoffs-consolation" />
                            <span>Enable consolation bracket</span>
                        </label>
                    </div>
                    <p id="playoffs-hint" class="playoff-hint"></p>
                </fieldset>

                <div class="setup-actions">
                    <button type="button" id="create-league">Create League</button>
                </div>
            </form>
        </section>

        <div id="league-panels" class="layout">
            <section class="panel hidden" id="draft-panel">
                <h2>Draft Your Team</h2>
                <p class="draft-status" id="draft-status">Loading draft…</p>
                <div class="draft-actions">
                    <button type="button" id="draft-autopick">Autodraft Pick</button>
                    <button type="button" id="draft-autopick-rest">Autodraft Rest</button>
                    <button type="button" id="draft-complete" disabled>Finish Draft</button>
                </div>
                <div class="draft-layout">
                    <div class="draft-roster" aria-live="polite">
                        <h3>Your Roster</h3>
                        <ul id="draft-roster-list" class="draft-roster-list"></ul>
                    </div>
                    <div class="draft-player-pool">
                        <div class="draft-search">
                            <input type="search" id="draft-search" placeholder="Search players…" />
                            <label for="draft-view" class="sr-only">Stat view</label>
                            <select id="draft-view">
                                <option value="averages" selected>Per Game</option>
                                <option value="totals">Season Totals</option>
                            </select>
                        </div>
                        <div id="draft-player-list" class="draft-player-list"></div>
                        <div class="draft-more">
                            <button type="button" id="draft-load-more">Load More</button>
                        </div>
                    </div>
                </div>
            </section>

            <div class="scoreboard-layout">
                <section class="panel" id="scoreboard-panel">
                    <h2>NBA Scoreboard</h2>
                    <div class="scoreboard-header">
                        <label for="scoreboard-date">Date</label>
                        <input type="date" id="scoreboard-date" disabled />
                    </div>
                    <ul id="scoreboard-list" class="scoreboard-list"></ul>
                    {% if (mode or 'standard') != 'gambling' %}
                    <section class="panel subpanel" id="players-panel">
                        <h3>Players</h3>
                        <div class="players-toolbar">
                            <input type="search" id="players-search" placeholder="Search players…" />
                            <select id="players-view">
                                <option value="totals">Totals</option>
                                <option value="averages">Averages</option>
                            </select>
                            <select id="players-filter">
                                <option value="all">All</option>
                                <option value="available">Available</option>
                                <option value="unavailable">Unavailable</option>
                            </select>
                            <span id="roster-status" class="roster-status" aria-live="polite"></span>
                        </div>
                        <div id="players-list" class="players-list"></div>
                    </section>
                    {% endif %}
                </section>
                <section class="panel betslip-panel" id="betting-panel">
                    <h3>Betting Slip</h3>
                    <div class="bankroll-overview" aria-live="polite">
                        <div><span>Balance</span><strong id="bankroll-available">$0.00</strong></div>
                        <div><span>Pending</span><strong id="bankroll-pending">$0.00</strong></div>
                        <div><span>Potential</span><strong id="bankroll-potential">$0.00</strong></div>
                    </div>
                    <div class="bet-slip" id="bet-slip">
                        <div class="bet-slip__selections" id="bet-slip-selections">
                            <p class="bet-slip__empty">Select odds from the scoreboard to build your slip.</p>
                        </div>
                        <div class="bet-slip__controls">
                            <label for="bet-slip-stake">Stake</label>
                            <input type="number" id="bet-slip-stake" min="1" step="1" value="10" />
                            <div class="bet-slip__summary">
                                <span>Type: <strong id="bet-slip-kind">Single</strong></span>
                                <span>Potential Payout: <strong id="bet-slip-payout">$0.00</strong></span>
                                <span id="bet-slip-odds-wrap" hidden>Parlay Odds: <strong id="bet-slip-odds">+0</strong></span>
                                <span id="bet-slip-profit-wrap" hidden>Potential Profit: <strong id="bet-slip-profit">$0.00</strong></span>
                            </div>
                            <div class="bet-slip__actions">
                                <button type="button" id="bet-slip-place" disabled>Place Bet</button>
                                <button type="button" id="bet-slip-clear" class="btn-secondary">Clear</button>
                            </div>
                            <p id="bet-slip-message" class="bet-slip__message" aria-live="polite"></p>
                        </div>
                    </div>
                    <div class="betting-tabs" role="tablist">
                        <button type="button" id="betting-tab-pending" class="active" role="tab">Pending</button>
                        <button type="button" id="betting-tab-settled" role="tab">Settled</button>
                    </div>
                    <div class="betting-lists">
                        <div id="pending-bets" class="betting-list"></div>
                        <div id="settled-bets" class="betting-list hidden"></div>
                    </div>
                </section>
            </div>
        {% if (mode or 'standard') != 'gambling' %}
            <section class="panel" id="fantasy-panel">
                <h2>Fantasy League</h2>
                <div class="league-meta">
                    <div>
                        <span>Current Date:</span>
                        <strong id="league-date">—</strong>
                    </div>
                    <div>
                        <span>Scoring Profile:</span>
                        <strong id="league-scoring">—</strong>
                    </div>
                    <div class="league-actions">
                        <button type="button" id="autoplay-league" title="Simulate the remainder of the regular season automatically">Auto-Sim Season</button>
                    </div>
                </div>
                <div id="fantasy-week-header" class="fantasy-week-header hidden">
                    <button type="button" id="week-prev" class="week-nav" aria-label="Previous week">&lsaquo;</button>
                    <select id="week-select" aria-label="Select matchup week"></select>
                    <button type="button" id="week-next" class="week-nav" aria-label="Next week">&rsaquo;</button>
                </div>
                <div id="fantasy-results" class="fantasy-matchups">
                    <p>Create a league to begin your season replay.</p>
                </div>
                <div id="fantasy-standings" class="fantasy-standings hidden"></div>
                <section id="playoffs-panel" class="fantasy-playoffs hidden" aria-live="polite">
                    <h3>Playoffs</h3>
                    <div class="playoff-panel-actions">
                        <button type="button" id="simulate-to-playoffs" class="btn-secondary hidden">Sim to Playoffs</button>
                        <button type="button" id="open-playoff-config" class="btn-secondary hidden">Edit Playoff Settings</button>
                    </div>
                    <div id="playoff-config-editor" class="playoff-config-editor hidden">
                        <div class="editor-row">
                            <label class="checkbox">
                                <input type="checkbox" id="edit-playoffs-enabled" />
                                <span>Enable playoffs</span>
                            </label>
                        </div>
                        <div class="editor-grid hidden" id="edit-playoff-controls">
                            <label for="edit-playoffs-team-count">Teams</label>
                            <select id="edit-playoffs-team-count"></select>

                            <label for="edit-playoffs-week-range">Week Window</label>
                            <select id="edit-playoffs-week-range"></select>

                            <label class="checkbox">
                                <input type="checkbox" id="edit-playoffs-reseed" />
                                <span>Reseed each round</span>
                            </label>

                            <label class="checkbox">
                                <input type="checkbox" id="edit-playoffs-consolation" />
                                <span>Enable consolation bracket</span>
                            </label>
                        </div>
                        <div class="editor-actions">
                            <button type="button" id="save-playoff-config" class="btn-primary">Save</button>
                            <button type="button" id="cancel-playoff-config" class="btn-secondary">Cancel</button>
                        </div>
                        <p id="edit-playoffs-hint" class="playoff-hint"></p>
                    </div>
                    <div id="playoffs-config" class="playoff-config-summary"></div>
                    <div id="playoff-bracket" class="playoff-bracket"></div>
                    <div id="playoff-placements" class="playoff-placements"></div>
                    <div id="consolation-bracket" class="playoff-consolation"></div>
                </section>
                <section id="roster-panel" class="fantasy-roster hidden">
                    <div class="fantasy-roster__header">
                        <h3>Team Roster (Daily)</h3>
                        <div class="fantasy-roster__controls">
                            <label for="roster-team-select" class="sr-only">Team</label>
                            <select id="roster-team-select" aria-label="Select fantasy team"></select>
                        </div>
                    </div>
                    <div id="roster-team-view"></div>
                </section>
            </section>
            {% endif %}
        </div>
    </main>

    <div id="player-modal" class="player-modal hidden" aria-hidden="true">
        <div class="player-modal__backdrop" data-close-player-modal></div>
        <div class="player-modal__container" role="dialog" aria-modal="true" aria-labelledby="player-modal-title">
            <button type="button" class="player-modal__close" data-close-player-modal aria-label="Close player card">&times;</button>
            <div id="player-modal-body" class="player-modal__body"></div>
        </div>
    </div>

    <div id="toast" class="toast hidden"></div>

    <script src="/static/dashboard.js" type="module"></script>
</body>
</html>
