(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();const st="./";async function Mt(){const t=await fetch(`${st}data/manifest.json`);if(!t.ok)throw new Error(`Manifest HTTP ${t.status}`);return t.json()}async function Nt(t){const e=await fetch(`${st}data/scoreboard/${t}.json`);if(e.status===404)return{date:t,games:[]};if(!e.ok)throw new Error(`Scoreboard HTTP ${e.status}`);return e.json()}async function Pt(t){const e=await fetch(`${st}data/boxscores/${t}.json`);if(!e.ok)throw new Error(`Boxscore HTTP ${e.status}`);return e.json()}const Z=(t,e)=>e.some(n=>t instanceof n);let it,ct;function It(){return it||(it=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ot(){return ct||(ct=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const tt=new WeakMap,J=new WeakMap,U=new WeakMap;function Ft(t){const e=new Promise((n,s)=>{const a=()=>{t.removeEventListener("success",r),t.removeEventListener("error",o)},r=()=>{n(P(t.result)),a()},o=()=>{s(t.error),a()};t.addEventListener("success",r),t.addEventListener("error",o)});return U.set(e,t),e}function At(t){if(tt.has(t))return;const e=new Promise((n,s)=>{const a=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",o),t.removeEventListener("abort",o)},r=()=>{n(),a()},o=()=>{s(t.error||new DOMException("AbortError","AbortError")),a()};t.addEventListener("complete",r),t.addEventListener("error",o),t.addEventListener("abort",o)});tt.set(t,e)}let et={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return tt.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return P(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function gt(t){et=t(et)}function jt(t){return Ot().includes(t)?function(...e){return t.apply(nt(this),e),P(this.request)}:function(...e){return P(t.apply(nt(this),e))}}function Rt(t){return typeof t=="function"?jt(t):(t instanceof IDBTransaction&&At(t),Z(t,It())?new Proxy(t,et):t)}function P(t){if(t instanceof IDBRequest)return Ft(t);if(J.has(t))return J.get(t);const e=Rt(t);return e!==t&&(J.set(t,e),U.set(e,t)),e}const nt=t=>U.get(t);function Ht(t,e,{blocked:n,upgrade:s,blocking:a,terminated:r}={}){const o=indexedDB.open(t,e),l=P(o);return s&&o.addEventListener("upgradeneeded",c=>{s(P(o.result),c.oldVersion,c.newVersion,P(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{r&&c.addEventListener("close",()=>r()),a&&c.addEventListener("versionchange",f=>a(f.oldVersion,f.newVersion,f))}).catch(()=>{}),l}const qt=["get","getKey","getAll","getAllKeys","count"],Vt=["put","add","delete","clear"],Q=new Map;function dt(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Q.get(e))return Q.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,a=Vt.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(a||qt.includes(n)))return;const r=async function(o,...l){const c=this.transaction(o,a?"readwrite":"readonly");let f=c.store;return s&&(f=f.index(l.shift())),(await Promise.all([f[n](...l),a&&c.done]))[0]};return Q.set(e,r),r}gt(t=>({...t,get:(e,n,s)=>dt(e,n)||t.get(e,n,s),has:(e,n)=>!!dt(e,n)||t.has(e,n)}));const Wt=["continue","continuePrimaryKey","advance"],lt={},at=new WeakMap,wt=new WeakMap,Kt={get(t,e){if(!Wt.includes(e))return t[e];let n=lt[e];return n||(n=lt[e]=function(...s){at.set(this,wt.get(this)[e](...s))}),n}};async function*Ut(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,Kt);for(wt.set(n,e),U.set(n,nt(e));e;)yield n,e=await(at.get(n)||e.continue()),at.delete(n)}function ut(t,e){return e===Symbol.asyncIterator&&Z(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&Z(t,[IDBIndex,IDBObjectStore])}gt(t=>({...t,get(e,n,s){return ut(e,n)?Ut:t.get(e,n,s)},has(e,n){return ut(e,n)||t.has(e,n)}}));const Gt="fantasybball",zt=3;let X=null;function x(){return X||(X=Ht(Gt,zt,{upgrade(t){t.objectStoreNames.contains("system")||t.createObjectStore("system",{keyPath:"key"}).put({key:"system",currentDate:new Date().toISOString().slice(0,10),bankroll:1e3,initialBankroll:1e3,pendingStake:0,pendingPotential:0}),t.objectStoreNames.contains("bets")||t.createObjectStore("bets",{keyPath:"id",autoIncrement:!0}),t.objectStoreNames.contains("scoreboards")||t.createObjectStore("scoreboards"),t.objectStoreNames.contains("boxscores")||t.createObjectStore("boxscores"),t.objectStoreNames.contains("simulations")||t.createObjectStore("simulations")}})),X}async function Jt(){return await(await x()).get("system","system")}async function K(t){const e=await x(),s={...await e.get("system","system"),...t};return await e.put("system",s),s}async function Qt(t){const n=await(await x()).add("bets",t);return{...t,id:n}}async function ft(){return await(await x()).transaction("bets").objectStore("bets").getAll()}async function Xt(t,e){const n=await x(),s=await n.get("bets",t);s&&await n.put("bets",{...s,...e})}async function Yt(t,e){await(await x()).put("scoreboards",e,t)}async function Zt(t){return(await x()).get("scoreboards",t)}async function te(t,e){await(await x()).put("boxscores",e,String(t))}async function ee(t){return(await x()).get("boxscores",String(t))}async function ne(t){return(await x()).get("simulations",t)}async function mt(t,e){return await(await x()).put("simulations",e,t),e}async function ae(){await(await x()).clear("bets")}async function se(){await(await x()).clear("simulations")}async function re(){await(await x()).clear("scoreboards")}async function oe(){await(await x()).clear("boxscores")}function p(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function j(t){return Number.isFinite(t)?t>0?1+t/100:1+100/Math.abs(t):1}function vt(t){return!Number.isFinite(t)||t<=1?0:t>=2?Math.round((t-1)*100):Math.round(-100/(t-1))}function I(t,e="USD"){const n=Number(t)||0;return new Intl.NumberFormat(void 0,{style:"currency",currency:e}).format(n)}function ie(t,e,n={}){t.innerHTML="",t.classList.add("scoreboard-list");const s=e.games||[];if(!s.length){const a=document.createElement("li");a.className="score-card disabled",a.innerHTML='<div class="teams"><div class="team-row"><span>No games to show.</span></div></div>',t.appendChild(a);return}s.forEach(a=>{const r=document.createElement("li");r.className="score-card",r.dataset.gameId=String(a.game_id),r.dataset.date=e.date||"";const o=document.createElement("div");o.className="score-summary";const c=(n.showFinalScores??!0)&&a.simulated,f=c?a.away_score??"--":"--",_=c?a.home_score??"--":"--",S=c?a.status||"Final":"Awaiting simulation",B=c?"status-final":"status-upcoming";o.innerHTML=`
      <div class="teams">
        <div class="team-row"><span>${p(a.away_team||"")}</span><span>${p(String(f))}</span></div>
        <div class="team-row"><span>${p(a.home_team||"")}</span><span>${p(String(_))}</span></div>
      </div>
      <div class="meta">
        <div class="${B}">${p(S)}</div>
        ${a.time?`<div>${p(a.time)}</div>`:""}
        ${a.period_display?`<div>${p(a.period_display)}</div>`:""}
      </div>
    `,r.appendChild(o);const y=ce(a,n.onOddsSelected);if(y&&r.appendChild(y),n.onRequestBoxscore&&c){const w=document.createElement("div");w.className="score-detail",w.innerHTML='<p class="muted">Click to load the full box score.</p>',r.appendChild(w),o.addEventListener("click",()=>h()),o.addEventListener("keydown",b=>{(b.key==="Enter"||b.key===" ")&&(b.preventDefault(),h())}),o.setAttribute("role","button"),o.setAttribute("tabindex","0");async function h(){var g;if(r.classList.contains("active")){r.classList.remove("active"),w.innerHTML='<p class="muted">Click to load the full box score.</p>';return}r.classList.add("active"),w.innerHTML='<p class="muted">Loading box scoreâ€¦</p>';try{const v=await((g=n.onRequestBoxscore)==null?void 0:g.call(n,a.game_id,e.date));if(!v){w.innerHTML='<p class="muted">Box score unavailable.</p>';return}fe(w,v)}catch(v){w.innerHTML=`<p class="error">${p(v.message||"Unable to load box score.")}</p>`}}}t.appendChild(r)})}function ce(t,e){const n=t==null?void 0:t.odds;if(!n||!n.markets)return null;const s=document.createElement("div");s.className="odds-preview";const a=n.markets;return a.moneyline&&s.appendChild(Y("Moneyline",de(t,a.moneyline,n,e))),a.spread&&s.appendChild(Y("Spread",le(t,a.spread,n,e))),a.total&&s.appendChild(Y("Total",ue(t,a.total,e))),s.childNodes.length?s:null}function Y(t,e){if(!e.length)return document.createElement("div");const n=document.createElement("div");n.className="odds-market";const s=document.createElement("div");s.className="odds-market__title",s.textContent=t;const a=document.createElement("div");return a.className="odds-market__chips",e.forEach(r=>a.appendChild(r)),n.append(s,a),n}function de(t,e,n,s){var f,_;const a=[],r=((f=n==null?void 0:n.home_team)==null?void 0:f.full_name)||t.home_team,o=((_=n==null?void 0:n.away_team)==null?void 0:_.full_name)||t.away_team,l=r?e==null?void 0:e[r]:void 0,c=o?e==null?void 0:e[o]:void 0;return c&&a.push(R(t,"moneyline","away",c.price,`${o||t.away_team} ML`,void 0,s)),l&&a.push(R(t,"moneyline","home",l.price,`${r||t.home_team} ML`,void 0,s)),a}function le(t,e,n,s){var f,_;const a=[],r=((f=n==null?void 0:n.home_team)==null?void 0:f.full_name)||t.home_team,o=((_=n==null?void 0:n.away_team)==null?void 0:_.full_name)||t.away_team,l=r?e==null?void 0:e[r]:void 0,c=o?e==null?void 0:e[o]:void 0;if(c){const S=c.point;a.push(R(t,"spread","away",c.price,`${o||t.away_team} ${bt(S)}`,S,s))}if(l){const S=l.point;a.push(R(t,"spread","home",l.price,`${r||t.home_team} ${bt(S)}`,S,s))}return a}function ue(t,e,n){const s=[];return Object.entries(e).forEach(([a,r])=>{const o=a.toLowerCase()==="over"?"over":"under",l=`${a} ${pe(r.point)}`;s.push(R(t,"total",o,r.price,l,r.point,n))}),s}function R(t,e,n,s,a,r,o){const l=document.createElement("button");l.type="button",l.className="odds-chip",l.innerHTML=`${p(a)} <span>${p(be(s))}</span>`;const c={game_id:t.game_id,label:a,market:e,selection:n,price:Number(s)||0,point:r};return l.dataset.oddsSelection=JSON.stringify(c),o?l.addEventListener("click",f=>{f.stopPropagation(),o({...c,game:t})}):l.disabled=!0,l}function fe(t,e){t.innerHTML="",t.appendChild(pt(e.away_team,"Away")),t.appendChild(pt(e.home_team,"Home"))}function pt(t,e){const n=document.createElement("section");n.className="boxscore-team";const s=document.createElement("h4");s.textContent=`${e}: ${t.name}${Number.isFinite(t.score)?` â€¢ ${t.score}`:""}`,n.appendChild(s);const a=document.createElement("div");a.className="boxscore-table-wrapper";const r=document.createElement("table");return r.className="boxscore-table",r.innerHTML=`
    <thead>
      <tr>
        <th>Player</th>
        <th>POS</th>
        <th>MIN</th>
        <th>FG</th>
        <th>3PT</th>
        <th>FT</th>
        <th>REB</th>
        <th>AST</th>
        <th>STL</th>
        <th>BLK</th>
        <th>TOV</th>
        <th>PTS</th>
      </tr>
    </thead>
    <tbody>
      ${t.players.map(o=>me(o)).join("")}
    </tbody>`,a.appendChild(r),n.appendChild(a),n}function me(t){const e=p(t.player_name||""),n=p(t.position||""),s=L(t.MINUTES,1),a=`${L(t.FGM)}/${L(t.FGA)}`,r=`${L(t.FG3M)}/${L(t.FG3A)}`,o=`${L(t.FTM)}/${L(t.FTA)}`,l=L(t.REB),c=L(t.AST),f=L(t.STL),_=L(t.BLK),S=L(t.TOV),B=L(t.PTS);return`
    <tr>
      <td>${e}</td>
      <td>${n}</td>
      <td>${s}</td>
      <td>${a}</td>
      <td>${r}</td>
      <td>${o}</td>
      <td>${l}</td>
      <td>${c}</td>
      <td>${f}</td>
      <td>${_}</td>
      <td>${S}</td>
      <td>${B}</td>
    </tr>`}function L(t,e=0){if(!Number.isFinite(t??NaN))return"0";const n=Math.pow(10,e);return String(Math.round((t??0)*n)/n).replace(/\.0+$/,"")}function bt(t){return t>0?`+${t}`:`${t}`}function pe(t){return t%1===0?t.toFixed(0):t.toString()}function be(t){return Number.isFinite(t)?t>0?`+${t}`:`${t}`:"0"}function ye(t,e,n,s,a){const{selections:r,bankroll:o}=e,l=t.querySelector("#bet-slip-stake"),c=t.querySelector("#bet-slip-kind"),f=t.querySelector("#bet-slip-odds-wrap"),_=t.querySelector("#bet-slip-odds"),S=t.querySelector("#bet-slip-profit-wrap"),B=t.querySelector("#bet-slip-profit"),y=t.querySelector("#bet-slip-payout"),w=t.querySelector("#bet-slip-place"),h=t.querySelector("#bet-slip-clear"),b=t.querySelector("#bet-slip-message"),g=t.querySelector("#bet-slip-selections"),v=Number(l.value||0),k=r.length>1;if(g.innerHTML="",r.length){const E=document.createElement("div");E.className="bet-card bet-card--slip";const F=St(r),A=`
      <div class="bet-card__header">
        <div class="bet-card__kind">${p(k?"Parlay":"Single")}</div>
        <div class="bet-card__price">${H(F||r[0].price)}</div>
        <div class="bet-card__status muted">Pending</div>
      </div>`,q=r.map($t).join("");E.innerHTML=`${A}<div class="bet-card__legs">${q}</div>`,g.appendChild(E)}else{const E=document.createElement("p");E.className="muted",E.textContent="Select odds from the scoreboard to build your slip.",g.appendChild(E)}c.textContent=k?"Parlay":"Single";const M=r.reduce((E,F)=>E*j(F.price),1),O=v>0?v*M:0;if(y.textContent=I(O),f.classList.toggle("hidden",!k),S.classList.toggle("hidden",!k),k){const E=vt(M);_.textContent=`${E>=0?"+":""}${E}`,B.textContent=I(Math.max(0,O-v))}w.disabled=!(r.length&&v>0&&v<=(o.available||0)),b.textContent=v>(o.available||0)?"Stake exceeds available balance.":"",l.oninput=()=>n(Number(l.value||0)),w.onclick=s,h.onclick=a}function he(t,e){const n=t.querySelector("#bankroll-available"),s=t.querySelector("#bankroll-pending"),a=t.querySelector("#bankroll-potential");n.textContent=I(e.available),s.textContent=I(e.pending_stake),a.textContent=I(e.pending_potential)}function ge(t,e,n,s){t.innerHTML=yt(n,"No pending bets.",!1),e.innerHTML=yt(s,"No settled bets.",!0)}function we(t){switch(t.market){case"moneyline":return t.label||(t.selection==="home"?"Home ML":"Away ML");case"spread":return`${_t(t.selection)} ${ve(t.point)}`;case"total":return`${t.selection==="over"?"Over":"Under"} ${_e(t.point)}`;default:return t.label||"Selection"}}function H(t){return Number.isFinite(t)?t>0?`+${t}`:`${t}`:"â€”"}function ve(t){return t==null?"":t>0?`+${t}`:`${t}`}function _e(t){return t==null?"":t%1===0?t.toFixed(0):t.toString()}function _t(t){return t&&t.charAt(0).toUpperCase()+t.slice(1)}function St(t){if(!t.length)return null;const e=t.reduce((n,s)=>n*j(s.price),1);return vt(e)}function $t(t){const e=t.label||we(t),n=H(t.price),s=Se(t),a=Be(t);return`
    <div class="bet-card__leg">
      <div>
        <strong>${p(e)}</strong>
        ${s?`<div class="bet-card__context">${p(s)}</div>`:""}
      </div>
      <div class="bet-card__leg-meta">
        <span class="bet-card__leg-price">${n}</span>
        ${a?`<span class="bet-card__leg-result ${a.toLowerCase()}">${p(a)}</span>`:""}
      </div>
    </div>`}function Se(t){const e=$e(t);if(!e)return"";const n=`${e.away_team} @ ${e.home_team}`,s=e.date?new Date(e.date).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"",a=e.time||"",r=[n];return s&&r.push(s),a&&r.push(a),r.join(" â€¢ ")}function $e(t){const e=t.metadata;return e&&e.game||t.game}function Be(t){const e=t.metadata,n=e==null?void 0:e.result;return!n||typeof n!="string"?"":n==="won"?"Won":n==="lost"?"Lost":n==="void"?"Push":n.charAt(0).toUpperCase()+n.slice(1)}function yt(t,e,n){return t.length?t.slice().sort((a,r)=>{const o=new Date(a.placed_at).getTime(),l=new Date(r.placed_at).getTime();return n?l-o:o-l}).map(Ee).join(""):`<p class="muted">${p(e)}</p>`}function Ee(t){var f;const e=St(t.legs),n=e!=null?H(e):H(((f=t.legs[0])==null?void 0:f.price)??0),s=xe(t.status),a=`bet-card bet-card--${t.status}`,r=t.legs.map($t).join(""),o=t.status==="pending"?"Potential":"Payout",l=I(t.payout??0),c=Le(t.placed_at);return`
    <div class="${a}">
      <div class="bet-card__header">
        <div class="bet-card__kind">${p(_t(t.kind))}</div>
        <div class="bet-card__price">${n}</div>
        <div class="bet-card__status">${p(s)}</div>
      </div>
      <div class="bet-card__legs">${r}</div>
      <dl class="bet-card__meta">
        <div><dt>Stake</dt><dd>${I(t.stake)}</dd></div>
        <div><dt>${p(o)}</dt><dd>${l}</dd></div>
        <div><dt>Placed</dt><dd>${p(c)}</dd></div>
      </dl>
    </div>`}function xe(t){switch(t){case"won":return"Won";case"lost":return"Lost";case"void":return"Push";default:return"Pending"}}function Le(t){const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}function De(t){return t.away_score==null||t.home_score==null?null:t.home_score>t.away_score?"home":t.away_score>t.home_score?"away":null}function Ce(t,e){const n=e.home_score,s=e.away_score;if(n==null||s==null)return"pending";switch(t.market){case"moneyline":{const a=De(e);return a==null?"pending":t.selection===a?"won":"lost"}case"spread":{if(t.selection!=="home"&&t.selection!=="away"||t.point==null)return"void";const a=t.selection==="home"?n:s,r=t.selection==="home"?s:n,o=a+t.point;return ht(o,r)?"void":o>r?"won":"lost"}case"total":{if(t.selection!=="over"&&t.selection!=="under"||t.point==null)return"void";const a=n+s;return ht(a,t.point)?"void":t.selection==="over"?a>t.point?"won":"lost":a<t.point?"won":"lost"}default:return"void"}}function ke(t,e){const n=t.legs.map(s=>{const a=e.get(s.game_id)||e.get(String(s.game_id));return a?Ce(s,a):"pending"});if(n.some(s=>s==="pending"))return{status:"pending"};if(t.kind==="single"){const s=n[0];if(s==="won"){const a=j(t.legs[0].price);return{status:"won",payout:+(t.stake*a).toFixed(2),legResults:n}}return s==="void"?{status:"void",payout:t.stake,legResults:n}:{status:"lost",payout:0,legResults:n}}if(n.some(s=>s==="lost"))return{status:"lost",payout:0,legResults:n};if(n.every(s=>s==="won")){const s=t.legs.reduce((r,o)=>r*j(o.price),1);return{status:"won",payout:+(t.stake*s).toFixed(2),legResults:n}}if(n.every(s=>s==="won"||s==="void")){const s=t.legs.reduce((r,o,l)=>r*(n[l]==="void"?1:j(o.price)),1);return{status:"won",payout:+(t.stake*s).toFixed(2),legResults:n}}return{status:"pending"}}function ht(t,e,n=1e-9){return Math.abs(t-e)<n}async function Te(){const t=document.getElementById("scoreboard-list"),e=document.getElementById("scoreboard-date"),n=document.getElementById("date-prev"),s=document.getElementById("date-next"),a=document.getElementById("simulate-day"),r=document.getElementById("reset-game"),o=document.querySelector("header"),l=document.querySelector("aside"),c=document.getElementById("pending-bets"),f=document.getElementById("settled-bets"),_=document.getElementById("bets-toggle-pending"),S=document.getElementById("bets-toggle-settled"),B=await F();let y=await Jt();const w=new Map;let h,b=!1;if(B!=null&&B.start_date){const i=new Set(B.dates||[]),d=B.start_date,u=y.currentDate;(!u||i.size>0&&u&&!i.has(u))&&(y=await K({currentDate:d})),e&&(e.min=B.start_date,B.end_date&&(e.max=B.end_date))}let g=[],v=[],k=[],M={available:y.bankroll,pending_stake:y.pendingStake,pending_potential:y.pendingPotential},O="pending";function E(i){const d=y.currentDate;if(d&&!b&&((h==null?void 0:h.games.length)||0)>0){const u=new Date(d);if(new Date(i)>u){window.alert("Simulate the current day before advancing."),e.value=d;return}}y={...y,currentDate:i},K({currentDate:i}),e.value=i,g=[],N(),A(i).catch(console.error)}async function F(){try{return await Mt()}catch{return{dates:[],start_date:"",end_date:""}}}async function A(i){let d=await Zt(i);if(!d)try{d=await Nt(i),await Yt(i,d)}catch{d={date:i,games:[]}}h=d;const u=await ne(i);b=!!(u!=null&&u.simulated),!b&&d.games.length===0&&(b=!0,await mt(i,{date:i,simulated:!0})),b&&d.games.length?await q(d):await z(),G()}async function q(i){const d=new Map(i.games.map(C=>[String(C.game_id),C])),D=(await ft()).filter(C=>C.status==="pending");for(const C of D){const m=ke(C,d);if(m.status!=="pending"){const $=C.legs.map((T,kt)=>{const ot=T.metadata||{},Tt={...ot,result:m.legResults?m.legResults[kt]:ot.result};return{...T,metadata:Tt}});await Xt(C.id,{status:m.status,payout:m.payout,legs:$})}}await z()}function G(){if(!h)return;const i=h.games.length>0;ie(t,h,{showFinalScores:b,onOddsSelected:b?void 0:d=>{g.push(d),N()},onRequestBoxscore:b?Bt:void 0}),Et(y.currentDate,b,i),W(O)}async function Bt(i){const d=String(i);if(w.has(d))return w.get(d);const u=await ee(i);if(u)return w.set(d,u),u;const D=await Pt(i);return await te(i,D),w.set(d,D),D}function Et(i,d,u){a&&(a.disabled=d||!u,u?a.textContent=d?"Day Simulated":"Simulate Day":a.textContent="No Games"),s&&(s.disabled=u&&!d)}async function z(){const i=await ft();v=i.filter($=>$.status==="pending"),k=i.filter($=>$.status!=="pending");const d=v.reduce(($,T)=>$+T.stake,0),u=v.reduce(($,T)=>$+(T.payout||0),0),D=k.reduce(($,T)=>$+((T.payout||0)-T.stake),0),m=(y.initialBankroll??1e3)+D-d;M={available:m,pending_stake:d,pending_potential:u},await K({bankroll:m,pendingStake:d,pendingPotential:u}),N()}function N(){he(o,M),ye(l,{selections:g,bankroll:M},i=>N(),xt,Lt),ge(c,f,v,k),W(O)}async function xt(){const i=document.getElementById("bet-slip-stake"),d=Number(i.value||0);if(!(d>0)||!g.length||d>M.available)return;const u=g.map(m=>({game_id:m.game_id,market:m.market,selection:m.selection,price:m.price,point:m.point,label:m.label,game:m.game,metadata:{...m.metadata||{},game:m.game||m.metadata&&m.metadata.game}})),D={placed_at:new Date().toISOString(),status:"pending",kind:g.length>1?"parlay":"single",stake:d,legs:u},C=g.reduce((m,$)=>m*($.price?$.price>0?1+$.price/100:1+100/Math.abs($.price):1),1);D.payout=+(d*C).toFixed(2),await Qt(D),g=[],await z()}function Lt(){g=[],N()}async function Dt(){if(!h||b)return;const i=y.currentDate;i&&(g=[],N(),b=!0,await mt(i,{date:i,simulated:!0,simulatedAt:new Date().toISOString()}),await q(h),G())}const V=B.start_date||y.currentDate||new Date().toISOString().slice(0,10);e.value=V,e.onchange=()=>E(e.value),n.onclick=()=>rt(-1),s.onclick=()=>rt(1),a&&(a.onclick=()=>Dt().catch(console.error)),r&&(r.onclick=()=>Ct(V).catch(console.error)),_&&(_.onclick=()=>W("pending")),S&&(S.onclick=()=>W("settled")),await A(V);function rt(i){if(i>0&&!b&&((h==null?void 0:h.games.length)||0)>0){window.alert("Simulate the current day before advancing.");return}const d=e.value||V,u=new Date(d);u.setDate(u.getDate()+i),E(u.toISOString().slice(0,10))}async function Ct(i){if(!window.confirm("Reset to season start? Current progress will remain but you will jump back to the first day."))return;const u=y.initialBankroll??1e3;y=await K({currentDate:i,bankroll:u,pendingStake:0,pendingPotential:0}),e.value=i,g=[],b=!1,h=void 0,w.clear(),v=[],k=[],M={available:u,pending_stake:0,pending_potential:0},N(),await ae(),await se(),await re(),await oe(),G(),await A(i)}function W(i){O=i,_&&_.classList.toggle("active",i==="pending"),S&&S.classList.toggle("active",i==="settled"),c&&c.classList.toggle("hidden",i!=="pending"),f&&f.classList.toggle("hidden",i!=="settled")}}Te();
