(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();const ce="./";async function Fe(){const e=await fetch(`${ce}data/manifest.json`);if(!e.ok)throw new Error(`Manifest HTTP ${e.status}`);return e.json()}async function Ae(e){const t=await fetch(`${ce}data/scoreboard/${e}.json`);if(t.status===404)return{date:e,games:[]};if(!t.ok)throw new Error(`Scoreboard HTTP ${t.status}`);return t.json()}async function je(e){const t=await fetch(`${ce}data/boxscores/${e}.json`);if(!t.ok)throw new Error(`Boxscore HTTP ${t.status}`);return t.json()}const ae=(e,t)=>t.some(n=>e instanceof n);let pe,be;function Re(){return pe||(pe=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function He(){return be||(be=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const se=new WeakMap,Z=new WeakMap,Q=new WeakMap;function qe(e){const t=new Promise((n,s)=>{const a=()=>{e.removeEventListener("success",r),e.removeEventListener("error",o)},r=()=>{n(A(e.result)),a()},o=()=>{s(e.error),a()};e.addEventListener("success",r),e.addEventListener("error",o)});return Q.set(t,e),t}function Ve(e){if(se.has(e))return;const t=new Promise((n,s)=>{const a=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",o),e.removeEventListener("abort",o)},r=()=>{n(),a()},o=()=>{s(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",r),e.addEventListener("error",o),e.addEventListener("abort",o)});se.set(e,t)}let re={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return se.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return A(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Be(e){re=e(re)}function We(e){return He().includes(e)?function(...t){return e.apply(oe(this),t),A(this.request)}:function(...t){return A(e.apply(oe(this),t))}}function Ke(e){return typeof e=="function"?We(e):(e instanceof IDBTransaction&&Ve(e),ae(e,Re())?new Proxy(e,re):e)}function A(e){if(e instanceof IDBRequest)return qe(e);if(Z.has(e))return Z.get(e);const t=Ke(e);return t!==e&&(Z.set(e,t),Q.set(t,e)),t}const oe=e=>Q.get(e);function Ue(e,t,{blocked:n,upgrade:s,blocking:a,terminated:r}={}){const o=indexedDB.open(e,t),d=A(o);return s&&o.addEventListener("upgradeneeded",i=>{s(A(o.result),i.oldVersion,i.newVersion,A(o.transaction),i)}),n&&o.addEventListener("blocked",i=>n(i.oldVersion,i.newVersion,i)),d.then(i=>{r&&i.addEventListener("close",()=>r()),a&&i.addEventListener("versionchange",u=>a(u.oldVersion,u.newVersion,u))}).catch(()=>{}),d}const Ge=["get","getKey","getAll","getAllKeys","count"],ze=["put","add","delete","clear"],ee=new Map;function ye(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(ee.get(t))return ee.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,a=ze.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(a||Ge.includes(n)))return;const r=async function(o,...d){const i=this.transaction(o,a?"readwrite":"readonly");let u=i.store;return s&&(u=u.index(d.shift())),(await Promise.all([u[n](...d),a&&i.done]))[0]};return ee.set(t,r),r}Be(e=>({...e,get:(t,n,s)=>ye(t,n)||e.get(t,n,s),has:(t,n)=>!!ye(t,n)||e.has(t,n)}));const Je=["continue","continuePrimaryKey","advance"],he={},ie=new WeakMap,Le=new WeakMap,Qe={get(e,t){if(!Je.includes(t))return e[t];let n=he[t];return n||(n=he[t]=function(...s){ie.set(this,Le.get(this)[t](...s))}),n}};async function*Xe(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,Qe);for(Le.set(n,t),Q.set(n,oe(t));t;)yield n,t=await(ie.get(n)||t.continue()),ie.delete(n)}function ge(e,t){return t===Symbol.asyncIterator&&ae(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&ae(e,[IDBIndex,IDBObjectStore])}Be(e=>({...e,get(t,n,s){return ge(t,n)?Xe:e.get(t,n,s)},has(t,n){return ge(t,n)||e.has(t,n)}}));const Ye="fantasybball",Ze=3;let te=null;function B(){return te||(te=Ue(Ye,Ze,{upgrade(e){e.objectStoreNames.contains("system")||e.createObjectStore("system",{keyPath:"key"}).put({key:"system",currentDate:new Date().toISOString().slice(0,10),bankroll:1e3,initialBankroll:1e3,pendingStake:0,pendingPotential:0}),e.objectStoreNames.contains("bets")||e.createObjectStore("bets",{keyPath:"id",autoIncrement:!0}),e.objectStoreNames.contains("scoreboards")||e.createObjectStore("scoreboards"),e.objectStoreNames.contains("boxscores")||e.createObjectStore("boxscores"),e.objectStoreNames.contains("simulations")||e.createObjectStore("simulations")}})),te}async function et(){return await(await B()).get("system","system")}async function J(e){const t=await B(),s={...await t.get("system","system"),...e};return await t.put("system",s),s}async function tt(e){const n=await(await B()).add("bets",e);return{...e,id:n}}async function we(){return await(await B()).transaction("bets").objectStore("bets").getAll()}async function nt(e,t){const n=await B(),s=await n.get("bets",e);s&&await n.put("bets",{...s,...t})}async function at(e,t){await(await B()).put("scoreboards",t,e)}async function st(e){return(await B()).get("scoreboards",e)}async function rt(e,t){await(await B()).put("boxscores",t,String(e))}async function ot(e){return(await B()).get("boxscores",String(e))}async function it(e){return(await B()).get("simulations",e)}async function ve(e,t){return await(await B()).put("simulations",t,e),t}async function ct(){await(await B()).clear("bets")}async function dt(){await(await B()).clear("simulations")}async function lt(){await(await B()).clear("scoreboards")}async function ut(){await(await B()).clear("boxscores")}function p(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function j(e){return Number.isFinite(e)?e>0?1+e/100:1+100/Math.abs(e):1}function mt(e){return!Number.isFinite(e)||e<=1?0:e>=2?Math.round((e-1)*100):Math.round(-100/(e-1))}function R(e,t="USD"){const n=Number(e)||0;return new Intl.NumberFormat(void 0,{style:"currency",currency:t}).format(n)}function ft(e,t,n={}){e.innerHTML="",e.classList.add("scoreboard-list");const s=t.games||[];if(!s.length){const a=document.createElement("li");a.className="score-card disabled",a.innerHTML='<div class="teams"><div class="team-row"><span>No games to show.</span></div></div>',e.appendChild(a);return}s.forEach(a=>{const r=document.createElement("li");r.className="score-card",r.dataset.gameId=String(a.game_id),r.dataset.date=t.date||"";const o=document.createElement("div");o.className="score-summary";const i=(n.showFinalScores??!0)&&a.simulated,u=i?a.away_score??"--":"--",f=i?a.home_score??"--":"--",h=i?a.status||"Final":"Awaiting simulation",b=i?"status-final":"status-upcoming";o.innerHTML=`
      <div class="teams">
        <div class="team-row"><span>${p(a.away_team||"")}</span><span>${p(String(u))}</span></div>
        <div class="team-row"><span>${p(a.home_team||"")}</span><span>${p(String(f))}</span></div>
      </div>
      <div class="meta">
        <div class="${b}">${p(h)}</div>
        ${a.time?`<div>${p(a.time)}</div>`:""}
        ${a.period_display?`<div>${p(a.period_display)}</div>`:""}
      </div>
    `,r.appendChild(o);const N=pt(a,n.oddsFormat??"american",n.onOddsSelected);if(N&&r.appendChild(N),n.onRequestBoxscore&&i){const g=document.createElement("div");g.className="score-detail",g.innerHTML='<p class="muted">Click to load the full box score.</p>',r.appendChild(g),o.addEventListener("click",()=>v()),o.addEventListener("keydown",L=>{(L.key==="Enter"||L.key===" ")&&(L.preventDefault(),v())}),o.setAttribute("role","button"),o.setAttribute("tabindex","0");async function v(){var _;if(r.classList.contains("active")){r.classList.remove("active"),g.innerHTML='<p class="muted">Click to load the full box score.</p>';return}r.classList.add("active"),g.innerHTML='<p class="muted">Loading box scoreâ€¦</p>';try{const w=await((_=n.onRequestBoxscore)==null?void 0:_.call(n,a.game_id,t.date));if(!w){g.innerHTML='<p class="muted">Box score unavailable.</p>';return}gt(g,w)}catch(w){g.innerHTML=`<p class="error">${p(w.message||"Unable to load box score.")}</p>`}}}e.appendChild(r)})}function pt(e,t,n){const s=e==null?void 0:e.odds;if(!s||!s.markets)return null;const a=document.createElement("div");a.className="odds-preview";const r=s.markets;return r.moneyline&&a.appendChild(ne("Moneyline",bt(e,r.moneyline,s,t,n))),r.spread&&a.appendChild(ne("Spread",yt(e,r.spread,s,t,n))),r.total&&a.appendChild(ne("Total",ht(e,r.total,t,n))),a.childNodes.length?a:null}function ne(e,t){if(!t.length)return document.createElement("div");const n=document.createElement("div");n.className="odds-market";const s=document.createElement("div");s.className="odds-market__title",s.textContent=e;const a=document.createElement("div");return a.className="odds-market__chips",t.forEach(r=>a.appendChild(r)),n.append(s,a),n}function bt(e,t,n,s,a){var f,h;const r=[],o=((f=n==null?void 0:n.home_team)==null?void 0:f.full_name)||e.home_team,d=((h=n==null?void 0:n.away_team)==null?void 0:h.full_name)||e.away_team,i=o?t==null?void 0:t[o]:void 0,u=d?t==null?void 0:t[d]:void 0;return u&&r.push(W(e,"moneyline","away",u.price,`${d||e.away_team} ML`,void 0,s,a)),i&&r.push(W(e,"moneyline","home",i.price,`${o||e.home_team} ML`,void 0,s,a)),r}function yt(e,t,n,s,a){var f,h;const r=[],o=((f=n==null?void 0:n.home_team)==null?void 0:f.full_name)||e.home_team,d=((h=n==null?void 0:n.away_team)==null?void 0:h.full_name)||e.away_team,i=o?t==null?void 0:t[o]:void 0,u=d?t==null?void 0:t[d]:void 0;if(u){const b=u.point;r.push(W(e,"spread","away",u.price,`${d||e.away_team} ${Se(b)}`,b,s,a))}if(i){const b=i.point;r.push(W(e,"spread","home",i.price,`${o||e.home_team} ${Se(b)}`,b,s,a))}return r}function ht(e,t,n,s){const a=[];return Object.entries(t).forEach(([r,o])=>{const d=r.toLowerCase()==="over"?"over":"under",i=`${r} ${vt(o.point)}`;a.push(W(e,"total",d,o.price,i,o.point,n,s))}),a}function W(e,t,n,s,a,r,o,d){const i=document.createElement("button");i.type="button",i.className="odds-chip",i.innerHTML=`${p(a)} <span>${p(_t(s,o))}</span>`;const u={game_id:e.game_id,label:a,market:t,selection:n,price:Number(s)||0,point:r};return i.dataset.oddsSelection=JSON.stringify(u),d?i.addEventListener("click",f=>{f.stopPropagation(),d({...u,game:e})}):i.disabled=!0,i}function gt(e,t){e.innerHTML="",e.appendChild(_e(t.away_team,"Away")),e.appendChild(_e(t.home_team,"Home"))}function _e(e,t){const n=document.createElement("section");n.className="boxscore-team";const s=document.createElement("h4");s.textContent=`${t}: ${e.name}${Number.isFinite(e.score)?` â€¢ ${e.score}`:""}`,n.appendChild(s);const a=document.createElement("div");a.className="boxscore-table-wrapper";const r=document.createElement("table");return r.className="boxscore-table",r.innerHTML=`
    <thead>
      <tr>
        <th>Player</th>
        <th>POS</th>
        <th>MIN</th>
        <th>FG</th>
        <th>3PT</th>
        <th>FT</th>
        <th>REB</th>
        <th>AST</th>
        <th>STL</th>
        <th>BLK</th>
        <th>TOV</th>
        <th>PTS</th>
      </tr>
    </thead>
    <tbody>
      ${e.players.map(o=>wt(o)).join("")}
    </tbody>`,a.appendChild(r),n.appendChild(a),n}function wt(e){const t=p(e.player_name||""),n=p(e.position||""),s=x(e.MINUTES,1),a=`${x(e.FGM)}/${x(e.FGA)}`,r=`${x(e.FG3M)}/${x(e.FG3A)}`,o=`${x(e.FTM)}/${x(e.FTA)}`,d=x(e.REB),i=x(e.AST),u=x(e.STL),f=x(e.BLK),h=x(e.TOV),b=x(e.PTS);return`
    <tr>
      <td>${t}</td>
      <td>${n}</td>
      <td>${s}</td>
      <td>${a}</td>
      <td>${r}</td>
      <td>${o}</td>
      <td>${d}</td>
      <td>${i}</td>
      <td>${u}</td>
      <td>${f}</td>
      <td>${h}</td>
      <td>${b}</td>
    </tr>`}function x(e,t=0){if(!Number.isFinite(e??NaN))return"0";const n=Math.pow(10,t);return String(Math.round((e??0)*n)/n).replace(/\.0+$/,"")}function Se(e){return e>0?`+${e}`:`${e}`}function vt(e){return e%1===0?e.toFixed(0):e.toString()}function _t(e,t){return Number.isFinite(e)?t==="decimal"?j(e).toFixed(2):e>0?`+${e}`:`${e}`:"â€”"}function St(e,t,n,s,a,r,o){const{selections:d,bankroll:i}=t,u=e.querySelector("#bet-slip-stake"),f=e.querySelector("#bet-slip-kind"),h=e.querySelector("#bet-slip-odds-wrap"),b=e.querySelector("#bet-slip-odds"),N=e.querySelector("#bet-slip-profit-wrap"),g=e.querySelector("#bet-slip-profit"),v=e.querySelector("#bet-slip-payout"),L=e.querySelector("#bet-slip-place"),_=e.querySelector("#bet-slip-clear"),w=e.querySelector("#bet-slip-message"),S=e.querySelector("#bet-slip-selections"),C=Number(u.value||0),k=d.length>1;if(S.innerHTML="",d.length){const $=document.createElement("div");$.className="bet-card bet-card--slip";const H=It(d,n),X=le(d[0].price,n),q=`
      <div class="bet-card__header">
        <div class="bet-card__kind">${p(k?"Parlay":"Single")}</div>
        <div class="bet-card__price">${p(k?H:X)}</div>
        <div class="bet-card__status muted">Pending</div>
      </div>`,K=d.map((M,V)=>Ce(M,n,V,!0)).join("");$.innerHTML=`${q}<div class="bet-card__legs">${K}</div>`,$.querySelectorAll(".bet-card__leg-remove").forEach(M=>{M.addEventListener("click",V=>{V.stopPropagation();const U=Number(M.dataset.index);Number.isInteger(U)&&o(U)})}),S.appendChild($)}else{const $=document.createElement("p");$.className="muted",$.textContent="Select odds from the scoreboard to build your slip.",S.appendChild($)}f.textContent=k?"Parlay":"Single";const O=d.reduce(($,H)=>$*j(H.price),1),F=C>0?C*O:0;v.textContent=R(F),h.classList.toggle("hidden",!k),N.classList.toggle("hidden",!k),k&&(b.textContent=de(O,n),g.textContent=R(Math.max(0,F-C))),L.disabled=!(d.length&&C>0&&C<=(i.available||0)),w.textContent=C>(i.available||0)?"Stake exceeds available balance.":"",u.oninput=()=>s(Number(u.value||0)),L.onclick=a,_.onclick=r}function $t(e,t){const n=e.querySelector("#bankroll-available"),s=e.querySelector("#bankroll-pending"),a=e.querySelector("#bankroll-potential");n.textContent=R(t.available),s.textContent=R(t.pending_stake),a.textContent=R(t.pending_potential)}function Et(e,t,n,s,a){e.innerHTML=$e(n,"No pending bets.",!1,a),t.innerHTML=$e(s,"No settled bets.",!0,a)}function Bt(e){switch(e.market){case"moneyline":return e.label||(e.selection==="home"?"Home ML":"Away ML");case"spread":return`${xe(e.selection)} ${Lt(e.point)}`;case"total":return`${e.selection==="over"?"Over":"Under"} ${xt(e.point)}`;default:return e.label||"Selection"}}function Lt(e){return e==null?"":e>0?`+${e}`:`${e}`}function xt(e){return e==null?"":e%1===0?e.toFixed(0):e.toString()}function xe(e){return e&&e.charAt(0).toUpperCase()+e.slice(1)}function Ce(e,t,n,s=!1){const a=e.label||Bt(e),r=le(e.price,t),o=Ct(e),d=kt(e),i=document.createElement("div");i.className="bet-card__leg";const u=document.createElement("div");u.innerHTML=`
    <strong>${p(a)}</strong>
    ${o?`<div class="bet-card__context">${p(o)}</div>`:""}`,i.appendChild(u);const f=document.createElement("div");if(f.className="bet-card__leg-meta",f.innerHTML=`
    <span class="bet-card__leg-price">${p(r)}</span>
    ${d?`<span class="bet-card__leg-result ${d.toLowerCase()}">${p(d)}</span>`:""}`,i.appendChild(f),s&&Number.isInteger(n)){const b=document.createElement("button");b.type="button",b.className="bet-card__leg-remove",b.textContent="Remove",b.dataset.index=String(n),i.appendChild(b)}const h=document.createElement("div");return h.appendChild(i),h.innerHTML}function Ct(e){const t=Dt(e);if(!t)return"";const n=`${t.away_team} @ ${t.home_team}`,s=t.date?new Date(t.date).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"",a=t.time||"",r=[n];return s&&r.push(s),a&&r.push(a),r.join(" â€¢ ")}function Dt(e){const t=e.metadata;return t&&t.game||e.game}function kt(e){const t=e.metadata,n=t==null?void 0:t.result;return!n||typeof n!="string"?"":n==="won"?"Won":n==="lost"?"Lost":n==="void"?"Push":n.charAt(0).toUpperCase()+n.slice(1)}function $e(e,t,n,s){return e.length?e.slice().sort((r,o)=>{const d=new Date(r.placed_at).getTime(),i=new Date(o.placed_at).getTime();return n?i-d:d-i}).map(r=>Tt(r,s)).join(""):`<p class="muted">${p(t)}</p>`}function Tt(e,t){var f;const n=De(e.legs),s=n!=null&&e.legs.length>1?de(n,t):le(((f=e.legs[0])==null?void 0:f.price)??0,t),a=Nt(e.status),r=`bet-card bet-card--${e.status}`,o=e.legs.map(h=>Ce(h,t)).join(""),d=e.status==="pending"?"Potential":"Payout",i=R(e.payout??0),u=Mt(e.placed_at);return`
    <div class="${r}">
      <div class="bet-card__header">
        <div class="bet-card__kind">${p(xe(e.kind))}</div>
        <div class="bet-card__price">${p(s)}</div>
        <div class="bet-card__status">${p(a)}</div>
      </div>
      <div class="bet-card__legs">${o}</div>
      <dl class="bet-card__meta">
        <div><dt>Stake</dt><dd>${R(e.stake)}</dd></div>
        <div><dt>${p(d)}</dt><dd>${i}</dd></div>
        <div><dt>Placed</dt><dd>${p(u)}</dd></div>
      </dl>
    </div>`}function Nt(e){switch(e){case"won":return"Won";case"lost":return"Lost";case"void":return"Push";default:return"Pending"}}function Mt(e){const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}function De(e){return e.length?e.reduce((t,n)=>t*j(n.price),1):null}function It(e,t){const n=De(e);return n==null?"â€”":de(n,t)}function de(e,t){if(!Number.isFinite(e)||e<=0)return"â€”";if(t==="decimal")return e.toFixed(2);const n=mt(e);return n>0?`+${n}`:`${n}`}function le(e,t){return Number.isFinite(e)?t==="decimal"?j(e).toFixed(2):e>0?`+${e}`:`${e}`:"â€”"}function Pt(e){return e.away_score==null||e.home_score==null?null:e.home_score>e.away_score?"home":e.away_score>e.home_score?"away":null}function Ot(e,t){const n=t.home_score,s=t.away_score;if(n==null||s==null)return"pending";switch(e.market){case"moneyline":{const a=Pt(t);return a==null?"pending":e.selection===a?"won":"lost"}case"spread":{if(e.selection!=="home"&&e.selection!=="away"||e.point==null)return"void";const a=e.selection==="home"?n:s,r=e.selection==="home"?s:n,o=a+e.point;return Ee(o,r)?"void":o>r?"won":"lost"}case"total":{if(e.selection!=="over"&&e.selection!=="under"||e.point==null)return"void";const a=n+s;return Ee(a,e.point)?"void":e.selection==="over"?a>e.point?"won":"lost":a<e.point?"won":"lost"}default:return"void"}}function Ft(e,t){const n=e.legs.map(s=>{const a=t.get(s.game_id)||t.get(String(s.game_id));return a?Ot(s,a):"pending"});if(n.some(s=>s==="pending"))return{status:"pending"};if(e.kind==="single"){const s=n[0];if(s==="won"){const a=j(e.legs[0].price);return{status:"won",payout:+(e.stake*a).toFixed(2),legResults:n}}return s==="void"?{status:"void",payout:e.stake,legResults:n}:{status:"lost",payout:0,legResults:n}}if(n.some(s=>s==="lost"))return{status:"lost",payout:0,legResults:n};if(n.every(s=>s==="won")){const s=e.legs.reduce((r,o)=>r*j(o.price),1);return{status:"won",payout:+(e.stake*s).toFixed(2),legResults:n}}if(n.every(s=>s==="won"||s==="void")){const s=e.legs.reduce((r,o,d)=>r*(n[d]==="void"?1:j(o.price)),1);return{status:"won",payout:+(e.stake*s).toFixed(2),legResults:n}}return{status:"pending"}}function Ee(e,t,n=1e-9){return Math.abs(e-t)<n}async function At(){const e=document.getElementById("scoreboard-list"),t=document.getElementById("scoreboard-date"),n=document.getElementById("date-prev"),s=document.getElementById("date-next"),a=document.getElementById("simulate-day"),r=document.getElementById("reset-game"),o=document.querySelector("header"),d=document.querySelector("aside"),i=document.getElementById("pending-bets"),u=document.getElementById("settled-bets"),f=document.getElementById("bets-toggle-pending"),h=document.getElementById("bets-toggle-settled"),b=document.getElementById("odds-format-american"),N=document.getElementById("odds-format-decimal"),g=await X();let v=await et();const L=new Map;let _,w=!1;if(g!=null&&g.start_date){const c=new Set(g.dates||[]),l=g.start_date,m=v.currentDate;(!m||c.size>0&&m&&!c.has(m))&&(v=await J({currentDate:l})),t&&(t.min=g.start_date,g.end_date&&(t.max=g.end_date))}let S=[],C=[],k=[],O={available:v.bankroll,pending_stake:v.pendingStake,pending_potential:v.pendingPotential},F="pending",$="american";function H(c){const l=v.currentDate;if(l&&!w&&((_==null?void 0:_.games.length)||0)>0){const m=new Date(l);if(new Date(c)>m){window.alert("Simulate the current day before advancing."),t.value=l;return}}v={...v,currentDate:c},J({currentDate:c}),t.value=c,S=[],I(),q(c).catch(console.error)}async function X(){try{return await Fe()}catch{return{dates:[],start_date:"",end_date:""}}}async function q(c){let l=await st(c);if(!l)try{l=await Ae(c),await at(c,l)}catch{l={date:c,games:[]}}_=l;const m=await it(c);w=!!(m!=null&&m.simulated),!w&&l.games.length===0&&(w=!0,await ve(c,{date:c,simulated:!0})),w&&l.games.length?await K(l):await Y(),M()}async function K(c){const l=new Map(c.games.map(T=>[String(T.game_id),T])),D=(await we()).filter(T=>T.status==="pending");for(const T of D){const y=Ft(T,l);if(y.status!=="pending"){const E=T.legs.map((P,Pe)=>{const fe=P.metadata||{},Oe={...fe,result:y.legResults?y.legResults[Pe]:fe.result};return{...P,metadata:Oe}});await nt(T.id,{status:y.status,payout:y.payout,legs:E})}}await Y()}function M(){if(!_)return;const c=_.games.length>0;ft(e,_,{showFinalScores:w,oddsFormat:$,onOddsSelected:w?void 0:l=>{S.push(l),I()},onRequestBoxscore:w?V:void 0}),U(v.currentDate,w,c),z(F)}async function V(c){const l=String(c);if(L.has(l))return L.get(l);const m=await ot(c);if(m)return L.set(l,m),m;const D=await je(c);return await rt(c,D),L.set(l,D),D}function U(c,l,m){a&&(a.disabled=l||!m,m?a.textContent=l?"Day Simulated":"Simulate Day":a.textContent="No Games"),s&&(s.disabled=m&&!l)}async function Y(){const c=await we();C=c.filter(E=>E.status==="pending"),k=c.filter(E=>E.status!=="pending");const l=C.reduce((E,P)=>E+P.stake,0),m=C.reduce((E,P)=>E+(P.payout||0),0),D=k.reduce((E,P)=>E+((P.payout||0)-P.stake),0),y=(v.initialBankroll??1e3)+D-l;O={available:y,pending_stake:l,pending_potential:m},await J({bankroll:y,pendingStake:l,pendingPotential:m}),I()}function I(){$t(o,O),St(d,{selections:S,bankroll:O},$,c=>I(),ke,Te,Ne),Et(i,u,C,k,$),z(F)}async function ke(){const c=document.getElementById("bet-slip-stake"),l=Number(c.value||0);if(!(l>0)||!S.length||l>O.available)return;const m=S.map(y=>({game_id:y.game_id,market:y.market,selection:y.selection,price:y.price,point:y.point,label:y.label,game:y.game,metadata:{...y.metadata||{},game:y.game||y.metadata&&y.metadata.game}})),D={placed_at:new Date().toISOString(),status:"pending",kind:S.length>1?"parlay":"single",stake:l,legs:m},T=S.reduce((y,E)=>y*(E.price?E.price>0?1+E.price/100:1+100/Math.abs(E.price):1),1);D.payout=+(l*T).toFixed(2),await tt(D),S=[],await Y()}function Te(){S=[],I()}function Ne(c){S.splice(c,1),I()}async function Me(){if(!_||w)return;const c=v.currentDate;c&&(S=[],I(),w=!0,await ve(c,{date:c,simulated:!0,simulatedAt:new Date().toISOString()}),await K(_),M())}const G=g.start_date||v.currentDate||new Date().toISOString().slice(0,10);t.value=G,t.onchange=()=>H(t.value),n.onclick=()=>ue(-1),s.onclick=()=>ue(1),a&&(a.onclick=()=>Me().catch(console.error)),r&&(r.onclick=()=>Ie(G).catch(console.error)),f&&(f.onclick=()=>z("pending")),h&&(h.onclick=()=>z("settled")),b&&(b.onclick=()=>me("american")),N&&(N.onclick=()=>me("decimal")),await q(G);function ue(c){if(c>0&&!w&&((_==null?void 0:_.games.length)||0)>0){window.alert("Simulate the current day before advancing.");return}const l=t.value||G,m=new Date(l);m.setDate(m.getDate()+c),H(m.toISOString().slice(0,10))}async function Ie(c){if(!window.confirm("Reset to season start? Current progress will remain but you will jump back to the first day."))return;const m=v.initialBankroll??1e3;v=await J({currentDate:c,bankroll:m,pendingStake:0,pendingPotential:0}),t.value=c,S=[],w=!1,_=void 0,L.clear(),C=[],k=[],O={available:m,pending_stake:0,pending_potential:0},F="pending",I(),await ct(),await dt(),await lt(),await ut(),M(),await q(c)}function z(c){F=c,f&&f.classList.toggle("active",c==="pending"),h&&h.classList.toggle("active",c==="settled"),i&&i.classList.toggle("hidden",c!=="pending"),u&&u.classList.toggle("hidden",c!=="settled")}function me(c){$!==c&&($=c,b&&b.classList.toggle("active",c==="american"),N&&N.classList.toggle("active",c==="decimal"),M(),I())}}At();
