(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function a(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=a(s);fetch(s.href,i)}})();const Mt="./";async function Ie(){const t=await fetch(`${Mt}data/manifest.json`);if(!t.ok)throw new Error(`Manifest HTTP ${t.status}`);return t.json()}async function Ne(t){const e=await fetch(`${Mt}data/scoreboard/${t}.json`);if(e.status===404)return{date:t,games:[]};if(!e.ok)throw new Error(`Scoreboard HTTP ${e.status}`);return e.json()}async function Te(t){const e=await fetch(`${Mt}data/boxscores/${t}.json`);if(!e.ok)throw new Error(`Boxscore HTTP ${e.status}`);return e.json()}const Lt=(t,e)=>e.some(a=>t instanceof a);let Qt,Xt;function Me(){return Qt||(Qt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function He(){return Xt||(Xt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const jt=new WeakMap,Et=new WeakMap,gt=new WeakMap;function Pe(t){const e=new Promise((a,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",l)},i=()=>{a(st(t.result)),s()},l=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",l)});return gt.set(e,t),e}function Re(t){if(jt.has(t))return;const e=new Promise((a,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",l),t.removeEventListener("abort",l)},i=()=>{a(),s()},l=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",l),t.addEventListener("abort",l)});jt.set(t,e)}let It={get(t,e,a){if(t instanceof IDBTransaction){if(e==="done")return jt.get(t);if(e==="store")return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return st(t[e])},set(t,e,a){return t[e]=a,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function le(t){It=t(It)}function Ae(t){return He().includes(t)?function(...e){return t.apply(Nt(this),e),st(this.request)}:function(...e){return st(t.apply(Nt(this),e))}}function Oe(t){return typeof t=="function"?Ae(t):(t instanceof IDBTransaction&&Re(t),Lt(t,Me())?new Proxy(t,It):t)}function st(t){if(t instanceof IDBRequest)return Pe(t);if(Et.has(t))return Et.get(t);const e=Oe(t);return e!==t&&(Et.set(t,e),gt.set(e,t)),e}const Nt=t=>gt.get(t);function Fe(t,e,{blocked:a,upgrade:r,blocking:s,terminated:i}={}){const l=indexedDB.open(t,e),b=st(l);return r&&l.addEventListener("upgradeneeded",f=>{r(st(l.result),f.oldVersion,f.newVersion,st(l.transaction),f)}),a&&l.addEventListener("blocked",f=>a(f.oldVersion,f.newVersion,f)),b.then(f=>{i&&f.addEventListener("close",()=>i()),s&&f.addEventListener("versionchange",y=>s(y.oldVersion,y.newVersion,y))}).catch(()=>{}),b}const qe=["get","getKey","getAll","getAllKeys","count"],Ve=["put","add","delete","clear"],_t=new Map;function Zt(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(_t.get(e))return _t.get(e);const a=e.replace(/FromIndex$/,""),r=e!==a,s=Ve.includes(a);if(!(a in(r?IDBIndex:IDBObjectStore).prototype)||!(s||qe.includes(a)))return;const i=async function(l,...b){const f=this.transaction(l,s?"readwrite":"readonly");let y=f.store;return r&&(y=y.index(b.shift())),(await Promise.all([y[a](...b),s&&f.done]))[0]};return _t.set(e,i),i}le(t=>({...t,get:(e,a,r)=>Zt(e,a)||t.get(e,a,r),has:(e,a)=>!!Zt(e,a)||t.has(e,a)}));const We=["continue","continuePrimaryKey","advance"],te={},Tt=new WeakMap,de=new WeakMap,Ke={get(t,e){if(!We.includes(e))return t[e];let a=te[e];return a||(a=te[e]=function(...r){Tt.set(this,de.get(this)[e](...r))}),a}};async function*Ue(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const a=new Proxy(e,Ke);for(de.set(a,e),gt.set(a,Nt(e));e;)yield a,e=await(Tt.get(a)||e.continue()),Tt.delete(a)}function ee(t,e){return e===Symbol.asyncIterator&&Lt(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&Lt(t,[IDBIndex,IDBObjectStore])}le(t=>({...t,get(e,a,r){return ee(e,a)?Ue:t.get(e,a,r)},has(e,a){return ee(e,a)||t.has(e,a)}}));const Ge="fantasybball",Je=3;let xt=null;function j(){return xt||(xt=Fe(Ge,Je,{upgrade(t){t.objectStoreNames.contains("system")||t.createObjectStore("system",{keyPath:"key"}).put({key:"system",currentDate:new Date().toISOString().slice(0,10),bankroll:1e3,initialBankroll:1e3,pendingStake:0,pendingPotential:0}),t.objectStoreNames.contains("bets")||t.createObjectStore("bets",{keyPath:"id",autoIncrement:!0}),t.objectStoreNames.contains("scoreboards")||t.createObjectStore("scoreboards"),t.objectStoreNames.contains("boxscores")||t.createObjectStore("boxscores"),t.objectStoreNames.contains("simulations")||t.createObjectStore("simulations")}})),xt}async function ze(){return await(await j()).get("system","system")}async function dt(t){const e=await j(),r={...await e.get("system","system"),...t};return await e.put("system",r),r}async function Ye(t){const a=await(await j()).add("bets",t);return{...t,id:a}}async function ne(){return await(await j()).transaction("bets").objectStore("bets").getAll()}async function Qe(t,e){const a=await j(),r=await a.get("bets",t);r&&await a.put("bets",{...r,...e})}async function Xe(t,e){await(await j()).put("scoreboards",e,t)}async function Ze(t){return(await j()).get("scoreboards",t)}async function tn(t,e){await(await j()).put("boxscores",e,String(t))}async function en(t){return(await j()).get("boxscores",String(t))}async function ae(t){return(await j()).get("simulations",t)}async function se(t,e){return await(await j()).put("simulations",e,t),e}async function nn(){await(await j()).clear("bets")}async function an(){await(await j()).clear("simulations")}async function sn(){await(await j()).clear("scoreboards")}async function on(){await(await j()).clear("boxscores")}function k(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function ot(t){return Number.isFinite(t)?t>0?1+t/100:1+100/Math.abs(t):1}function rn(t){return!Number.isFinite(t)||t<=1?0:t>=2?Math.round((t-1)*100):Math.round(-100/(t-1))}function J(t,e="USD"){const a=Number(t)||0;return new Intl.NumberFormat(void 0,{style:"currency",currency:e}).format(a)}function cn(t,e,a={}){t.innerHTML="",t.classList.add("scoreboard-list");const r=e.games||[];if(!r.length){const s=document.createElement("li");s.className="score-card disabled",s.innerHTML='<div class="teams"><div class="team-row"><span>No games to show.</span></div></div>',t.appendChild(s);return}r.forEach(s=>{const i=document.createElement("li");i.className="score-card",i.dataset.gameId=String(s.game_id),i.dataset.date=e.date||"";const l=document.createElement("div");l.className="score-summary";const f=(a.showFinalScores??!0)&&s.simulated,y=f?s.away_score??"--":"--",v=f?s.home_score??"--":"--",$=f?s.status||"Final":"Awaiting simulation",w=f?"status-final":"status-upcoming";l.innerHTML=`
      <div class="teams">
        <div class="team-row"><span>${k(s.away_team||"")}</span><span>${k(String(y))}</span></div>
        <div class="team-row"><span>${k(s.home_team||"")}</span><span>${k(String(v))}</span></div>
      </div>
      <div class="meta">
        <div class="${w}">${k($)}</div>
        ${s.time?`<div>${k(s.time)}</div>`:""}
        ${s.period_display?`<div>${k(s.period_display)}</div>`:""}
      </div>
    `,i.appendChild(l);const V=ln(s,a.oddsFormat??"american",a.onOddsSelected);if(V&&i.appendChild(V),a.onRequestBoxscore&&f){const x=document.createElement("div");x.className="score-detail",x.innerHTML='<p class="muted">Click to load the full box score.</p>',i.appendChild(x),l.addEventListener("click",()=>W()),l.addEventListener("keydown",I=>{(I.key==="Enter"||I.key===" ")&&(I.preventDefault(),W())}),l.setAttribute("role","button"),l.setAttribute("tabindex","0");async function W(){var P;if(i.classList.contains("active")){i.classList.remove("active"),x.innerHTML='<p class="muted">Click to load the full box score.</p>';return}i.classList.add("active"),x.innerHTML='<p class="muted">Loading box score…</p>';try{const T=await((P=a.onRequestBoxscore)==null?void 0:P.call(a,s.game_id,e.date));if(!T){x.innerHTML='<p class="muted">Box score unavailable.</p>';return}mn(x,T)}catch(T){x.innerHTML=`<p class="error">${k(T.message||"Unable to load box score.")}</p>`}}}t.appendChild(i)})}function ln(t,e,a){const r=t==null?void 0:t.odds;if(!r||!r.markets)return null;const s=document.createElement("div");s.className="odds-preview";const i=r.markets;return i.moneyline&&s.appendChild(Dt("Moneyline",dn(t,i.moneyline,r,e,a))),i.spread&&s.appendChild(Dt("Spread",un(t,i.spread,r,e,a))),i.total&&s.appendChild(Dt("Total",fn(t,i.total,e,a))),s.childNodes.length?s:null}function Dt(t,e){if(!e.length)return document.createElement("div");const a=document.createElement("div");a.className="odds-market";const r=document.createElement("div");r.className="odds-market__title",r.textContent=t;const s=document.createElement("div");return s.className="odds-market__chips",e.forEach(i=>s.appendChild(i)),a.append(r,s),a}function dn(t,e,a,r,s){var v,$;const i=[],l=((v=a==null?void 0:a.home_team)==null?void 0:v.full_name)||t.home_team,b=(($=a==null?void 0:a.away_team)==null?void 0:$.full_name)||t.away_team,f=l?e==null?void 0:e[l]:void 0,y=b?e==null?void 0:e[b]:void 0;return y&&i.push(ut(t,"moneyline","away",y.price,`${b||t.away_team} ML`,void 0,r,s)),f&&i.push(ut(t,"moneyline","home",f.price,`${l||t.home_team} ML`,void 0,r,s)),i}function un(t,e,a,r,s){var v,$;const i=[],l=((v=a==null?void 0:a.home_team)==null?void 0:v.full_name)||t.home_team,b=(($=a==null?void 0:a.away_team)==null?void 0:$.full_name)||t.away_team,f=l?e==null?void 0:e[l]:void 0,y=b?e==null?void 0:e[b]:void 0;if(y){const w=y.point;i.push(ut(t,"spread","away",y.price,`${b||t.away_team} ${re(w)}`,w,r,s))}if(f){const w=f.point;i.push(ut(t,"spread","home",f.price,`${l||t.home_team} ${re(w)}`,w,r,s))}return i}function fn(t,e,a,r){const s=[];return Object.entries(e).forEach(([i,l])=>{const b=i.toLowerCase()==="over"?"over":"under",f=`${i} ${bn(l.point)}`;s.push(ut(t,"total",b,l.price,f,l.point,a,r))}),s}function ut(t,e,a,r,s,i,l,b){const f=document.createElement("button");f.type="button",f.className="odds-chip",f.innerHTML=`${k(s)} <span>${k(hn(r,l))}</span>`;const y={game_id:t.game_id,label:s,market:e,selection:a,price:Number(r)||0,point:i};return f.dataset.oddsSelection=JSON.stringify(y),b?f.addEventListener("click",v=>{v.stopPropagation(),b({...y,game:t})}):f.disabled=!0,f}function mn(t,e){t.innerHTML="",t.appendChild(oe(e.away_team,"Away")),t.appendChild(oe(e.home_team,"Home"))}function oe(t,e){const a=document.createElement("section");a.className="boxscore-team";const r=document.createElement("h4");r.textContent=`${e}: ${t.name}${Number.isFinite(t.score)?` • ${t.score}`:""}`,a.appendChild(r);const s=document.createElement("div");s.className="boxscore-table-wrapper";const i=document.createElement("table");return i.className="boxscore-table",i.innerHTML=`
    <thead>
      <tr>
        <th>Player</th>
        <th>POS</th>
        <th>MIN</th>
        <th>FG</th>
        <th>3PT</th>
        <th>FT</th>
        <th>REB</th>
        <th>AST</th>
        <th>STL</th>
        <th>BLK</th>
        <th>TOV</th>
        <th>PTS</th>
      </tr>
    </thead>
    <tbody>
      ${t.players.map(l=>pn(l)).join("")}
    </tbody>`,s.appendChild(i),a.appendChild(s),a}function pn(t){const e=k(t.player_name||""),a=k(t.position||""),r=N(t.MINUTES,1),s=`${N(t.FGM)}/${N(t.FGA)}`,i=`${N(t.FG3M)}/${N(t.FG3A)}`,l=`${N(t.FTM)}/${N(t.FTA)}`,b=N(t.REB),f=N(t.AST),y=N(t.STL),v=N(t.BLK),$=N(t.TOV),w=N(t.PTS);return`
    <tr>
      <td>${e}</td>
      <td>${a}</td>
      <td>${r}</td>
      <td>${s}</td>
      <td>${i}</td>
      <td>${l}</td>
      <td>${b}</td>
      <td>${f}</td>
      <td>${y}</td>
      <td>${v}</td>
      <td>${$}</td>
      <td>${w}</td>
    </tr>`}function N(t,e=0){if(!Number.isFinite(t??NaN))return"0";const a=Math.pow(10,e);return String(Math.round((t??0)*a)/a).replace(/\.0+$/,"")}function re(t){return t>0?`+${t}`:`${t}`}function bn(t){return t%1===0?t.toFixed(0):t.toString()}function hn(t,e){return Number.isFinite(t)?e==="decimal"?ot(t).toFixed(2):t>0?`+${t}`:`${t}`:"—"}function yn(t,e,a,r,s,i,l,b){const{selections:f,bankroll:y}=e,v=t.querySelector("#bet-slip-stake"),$=t.querySelector("#bet-slip-kind"),w=t.querySelector("#bet-slip-odds-wrap"),V=t.querySelector("#bet-slip-odds"),x=t.querySelector("#bet-slip-profit-wrap"),W=t.querySelector("#bet-slip-profit"),I=t.querySelector("#bet-slip-payout"),P=t.querySelector("#bet-slip-place"),T=t.querySelector("#bet-slip-clear"),X=t.querySelector("#bet-slip-message"),K=t.querySelector("#bet-slip-selections"),_=Number(v.value||0),R=f.length>1;if(K.innerHTML="",f.length){const g=document.createElement("div");g.className="bet-card bet-card--slip";const S=xn(f,a),Z=Pt(f[0].price,a),D=`
      <div class="bet-card__header">
        <div class="bet-card__kind">${k(R?"Parlay":"Single")}</div>
        <div class="bet-card__price">${k(R?S:Z)}</div>
        <div class="bet-card__status muted">Pending</div>
      </div>`,L=f.map((B,U)=>fe(B,a,U,!0)).join("");g.innerHTML=`${D}<div class="bet-card__legs">${L}</div>`,g.querySelectorAll(".bet-card__leg-remove").forEach(B=>{B.addEventListener("click",U=>{U.stopPropagation();const tt=Number(B.dataset.index);Number.isInteger(tt)&&b(tt)})}),K.appendChild(g)}else{const g=document.createElement("p");g.className="muted",g.textContent="Select odds from the scoreboard to build your slip.",K.appendChild(g)}$.textContent=R?"Parlay":"Single";const rt=f.reduce((g,S)=>g*ot(S.price),1),ct=_>0?_*rt:0;I.textContent=J(ct),w.classList.toggle("hidden",!R),x.classList.toggle("hidden",!R),R&&(V.textContent=Ht(rt,a),W.textContent=J(Math.max(0,ct-_))),P.disabled=!(f.length&&_>0&&_<=(y.available||0));const A=_>(y.available||0)?"Stake exceeds available balance.":"";X.textContent=A||r,v.oninput=()=>s(Number(v.value||0)),P.onclick=i,T.onclick=l}function at(t,e){const a=t.querySelector("#bankroll-available"),r=t.querySelector("#bankroll-pending"),s=t.querySelector("#bankroll-potential");a.textContent=J(e.available),r.textContent=J(e.pending_stake),s.textContent=J(e.pending_potential)}function gn(t,e,a,r,s){t.innerHTML=ce(a,"No pending bets.",!1,s),e.innerHTML=ce(r,"No settled bets.",!0,s)}function vn(t){switch(t.market){case"moneyline":return t.label||(t.selection==="home"?"Home ML":"Away ML");case"spread":return`${ue(t.selection)} ${kn(t.point)}`;case"total":return`${t.selection==="over"?"Over":"Under"} ${wn(t.point)}`;default:return t.label||"Selection"}}function kn(t){return t==null?"":t>0?`+${t}`:`${t}`}function wn(t){return t==null?"":t%1===0?t.toFixed(0):t.toString()}function ue(t){return t&&t.charAt(0).toUpperCase()+t.slice(1)}function fe(t,e,a,r=!1){const s=t.label||vn(t),i=Pt(t.price,e),l=$n(t),b=Bn(t),f=document.createElement("div");f.className="bet-card__leg";const y=document.createElement("div");y.innerHTML=`
    <strong>${k(s)}</strong>
    ${l?`<div class="bet-card__context">${k(l)}</div>`:""}`,f.appendChild(y);const v=document.createElement("div");if(v.className="bet-card__leg-meta",v.innerHTML=`
    <span class="bet-card__leg-price">${k(i)}</span>
    ${b?`<span class="bet-card__leg-result ${b.toLowerCase()}">${k(b)}</span>`:""}`,f.appendChild(v),r&&Number.isInteger(a)){const w=document.createElement("button");w.type="button",w.className="bet-card__leg-remove",w.textContent="Remove",w.dataset.index=String(a),f.appendChild(w)}const $=document.createElement("div");return $.appendChild(f),$.innerHTML}function $n(t){const e=Sn(t);if(!e)return"";const a=`${e.away_team} @ ${e.home_team}`,r=e.date?new Date(e.date).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"",s=e.time||"",i=[a];return r&&i.push(r),s&&i.push(s),i.join(" • ")}function Sn(t){const e=t.metadata;return e&&e.game||t.game}function Bn(t){const e=t.metadata,a=e==null?void 0:e.result;return!a||typeof a!="string"?"":a==="won"?"Won":a==="lost"?"Lost":a==="void"?"Push":a.charAt(0).toUpperCase()+a.slice(1)}function ce(t,e,a,r){return t.length?t.slice().sort((i,l)=>{const b=new Date(i.placed_at).getTime(),f=new Date(l.placed_at).getTime();return a?f-b:b-f}).map(i=>Cn(i,r)).join(""):`<p class="muted">${k(e)}</p>`}function Cn(t,e){var v;const a=me(t.legs),r=a!=null&&t.legs.length>1?Ht(a,e):Pt(((v=t.legs[0])==null?void 0:v.price)??0,e),s=En(t.status),i=`bet-card bet-card--${t.status}`,l=t.legs.map($=>fe($,e)).join(""),b=t.status==="pending"?"Potential":"Payout",f=J(t.payout??0),y=_n(t.placed_at);return`
    <div class="${i}">
      <div class="bet-card__header">
        <div class="bet-card__kind">${k(ue(t.kind))}</div>
        <div class="bet-card__price">${k(r)}</div>
        <div class="bet-card__status">${k(s)}</div>
      </div>
      <div class="bet-card__legs">${l}</div>
      <dl class="bet-card__meta">
        <div><dt>Stake</dt><dd>${J(t.stake)}</dd></div>
        <div><dt>${k(b)}</dt><dd>${f}</dd></div>
        <div><dt>Placed</dt><dd>${k(y)}</dd></div>
      </dl>
    </div>`}function En(t){switch(t){case"won":return"Won";case"lost":return"Lost";case"void":return"Push";default:return"Pending"}}function _n(t){const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}function me(t){return t.length?t.reduce((e,a)=>e*ot(a.price),1):null}function xn(t,e){const a=me(t);return a==null?"—":Ht(a,e)}function Ht(t,e){if(!Number.isFinite(t)||t<=0)return"—";if(e==="decimal")return t.toFixed(2);const a=rn(t);return a>0?`+${a}`:`${a}`}function Pt(t,e){return Number.isFinite(t)?e==="decimal"?ot(t).toFixed(2):t>0?`+${t}`:`${t}`:"—"}function Dn(t){return t.away_score==null||t.home_score==null?null:t.home_score>t.away_score?"home":t.away_score>t.home_score?"away":null}function Ln(t,e){const a=e.home_score,r=e.away_score;if(a==null||r==null)return"pending";switch(t.market){case"moneyline":{const s=Dn(e);return s==null?"pending":t.selection===s?"won":"lost"}case"spread":{if(t.selection!=="home"&&t.selection!=="away"||t.point==null)return"void";const s=t.selection==="home"?a:r,i=t.selection==="home"?r:a,l=s+t.point;return ie(l,i)?"void":l>i?"won":"lost"}case"total":{if(t.selection!=="over"&&t.selection!=="under"||t.point==null)return"void";const s=a+r;return ie(s,t.point)?"void":t.selection==="over"?s>t.point?"won":"lost":s<t.point?"won":"lost"}default:return"void"}}function jn(t,e){const a=t.legs.map(r=>{const s=e.get(r.game_id)||e.get(String(r.game_id));return s?Ln(r,s):"pending"});if(a.some(r=>r==="pending"))return{status:"pending"};if(t.kind==="single"){const r=a[0];if(r==="won"){const s=ot(t.legs[0].price);return{status:"won",payout:+(t.stake*s).toFixed(2),legResults:a}}return r==="void"?{status:"void",payout:t.stake,legResults:a}:{status:"lost",payout:0,legResults:a}}if(a.some(r=>r==="lost"))return{status:"lost",payout:0,legResults:a};if(a.every(r=>r==="won")){const r=t.legs.reduce((i,l)=>i*ot(l.price),1);return{status:"won",payout:+(t.stake*r).toFixed(2),legResults:a}}if(a.every(r=>r==="won"||r==="void")){const r=t.legs.reduce((i,l,b)=>i*(a[b]==="void"?1:ot(l.price)),1);return{status:"won",payout:+(t.stake*r).toFixed(2),legResults:a}}return{status:"pending"}}function ie(t,e,a=1e-9){return Math.abs(t-e)<a}const In=["♠","♥","♦","♣"],Nn=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];let Y=[],Q=0;async function Tn(){const t=document.getElementById("scoreboard-list"),e=document.getElementById("scoreboard-date"),a=document.getElementById("date-prev"),r=document.getElementById("date-next"),s=document.getElementById("simulate-day"),i=document.getElementById("reset-game"),l=document.getElementById("scoreboard-current-date"),b=document.querySelector("header"),f=document.querySelector("aside"),y=document.getElementById("pending-bets"),v=document.getElementById("settled-bets"),$=document.getElementById("bets-toggle-pending"),w=document.getElementById("bets-toggle-settled"),V=document.getElementById("odds-format-american"),x=document.getElementById("odds-format-decimal"),W=document.getElementById("blackjack-stake"),I=document.getElementById("blackjack-deal"),P=document.getElementById("blackjack-hit"),T=document.getElementById("blackjack-stand"),X=document.getElementById("blackjack-double"),K=document.getElementById("blackjack-split"),_=document.getElementById("blackjack-status"),R=document.getElementById("roulette-stake"),rt=document.getElementById("roulette-choice"),ct=document.getElementById("roulette-spin"),A=document.getElementById("roulette-status"),g=await pe();let S=await ze();const Z=new Map;let D,L=!1;if(g!=null&&g.start_date){const n=new Set(g.dates||[]),o=g.start_date,c=S.currentDate;(!c||n.size>0&&c&&!n.has(c))&&(S=await dt({currentDate:o})),e&&(e.min=g.start_date,g.end_date&&(e.max=g.end_date))}let B=[],U=[],tt=[],C={available:S.bankroll,pending_stake:S.pendingStake,pending_potential:S.pendingPotential},ft="pending",it="american",O="",d=null,et=(g==null?void 0:g.start_date)||S.currentDate;function Rt(n){const o=S.currentDate;if(o&&!L&&((D==null?void 0:D.games.length)||0)>0){const c=new Date(o);if(new Date(n)>c){window.alert("Simulate the current day before advancing."),e.value=o;return}}S={...S,currentDate:n},dt({currentDate:n}),e.value=n,B=[],O="",M(),vt(n).catch(console.error)}async function pe(){try{return await Ie()}catch{return{dates:[],start_date:"",end_date:""}}}async function vt(n){let o=await Ze(n);if(!o)try{o=await Ne(n),await Xe(n,o)}catch{o={date:n,games:[]}}D=o;const c=await ae(n);L=!!(c!=null&&c.simulated),!L&&o.games.length===0&&(L=!0,await se(n,{date:n,simulated:!0})),L&&o.games.length?await At(o):await kt(),await qt(),mt()}async function At(n){const o=new Map(n.games.map(p=>[String(p.game_id),p])),u=(await ne()).filter(p=>p.status==="pending");for(const p of u){const m=jn(p,o);if(m.status!=="pending"){const h=p.legs.map((E,H)=>{const yt=E.metadata||{},nt={...yt,result:m.legResults?m.legResults[H]:yt.result};return{...E,metadata:nt}});await Qe(p.id,{status:m.status,payout:m.payout,legs:h})}}await kt()}function mt(){if(!D)return;const n=D.games.length>0;cn(t,D,{showFinalScores:L,oddsFormat:it,onOddsSelected:L?void 0:ke,onRequestBoxscore:L?be:void 0}),he(S.currentDate,L,n),bt(ft)}async function be(n){const o=String(n);if(Z.has(o))return Z.get(o);const c=await en(n);if(c)return Z.set(o,c),c;const u=await Te(n);return await tn(n,u),Z.set(o,u),u}function he(n,o,c){s&&(s.disabled=o||!c,c?s.textContent=o?"Day Simulated":"Simulate Day":s.textContent="No Games"),r&&(r.disabled=c&&!o)}async function kt(){const n=await ne();U=n.filter(h=>h.status==="pending"),tt=n.filter(h=>h.status!=="pending");const o=U.reduce((h,E)=>h+E.stake,0),c=U.reduce((h,E)=>h+(E.payout||0),0),u=tt.reduce((h,E)=>h+((E.payout||0)-E.stake),0),m=(S.initialBankroll??1e3)+u-o;C={available:m,pending_stake:o,pending_potential:c},await dt({bankroll:m,pendingStake:o,pendingPotential:c}),M()}function M(){at(b,C),yn(f,{selections:B,bankroll:C},it,O,n=>M(),ye,ge,ve),gn(y,v,U,tt,it),bt(ft),q()}async function ye(){const n=document.getElementById("bet-slip-stake"),o=Number(n.value||0);if(!(o>0)||!B.length||o>C.available)return;const c=B.map(m=>({game_id:m.game_id,market:m.market,selection:m.selection,price:m.price,point:m.point,label:m.label,game:m.game,metadata:{...m.metadata||{},game:m.game||m.metadata&&m.metadata.game}})),u={placed_at:new Date().toISOString(),status:"pending",kind:B.length>1?"parlay":"single",stake:o,legs:c},p=B.reduce((m,h)=>m*(h.price?h.price>0?1+h.price/100:1+100/Math.abs(h.price):1),1);u.payout=+(o*p).toFixed(2),await Ye(u),B=[],O="",await kt()}function ge(){B=[],O="",M()}function ve(n){B.splice(n,1),O="",M()}function ke(n){const o=String(n.game_id),c=B.filter(u=>String(u.game_id)===o);if(n.market==="total"){if(c.some(u=>u.market==="total")){O="Only one total selection per game.",M();return}}else if(c.some(u=>u.market==="moneyline"||u.market==="spread")){O="Only one moneyline or spread selection per game.",M();return}if(B.some(u=>u.game_id===n.game_id&&u.market===n.market&&u.selection===n.selection&&(u.point??null)===(n.point??null))){O="Selection already added.",M();return}O="",B.push(n),M()}function z(n){!Number.isFinite(n)||n===0||(C.available=Math.max(0,C.available+n),dt({bankroll:C.available}).then(o=>{S={...S,bankroll:o.bankroll}}).catch(()=>{}))}async function we(){if(!D||L)return;const n=S.currentDate;n&&(B=[],O="",M(),L=!0,await se(n,{date:n,simulated:!0,simulatedAt:new Date().toISOString()}),await At(D),await qt(),mt())}const pt=g.start_date||S.currentDate||new Date().toISOString().slice(0,10);e.value=pt,e.onchange=()=>Rt(e.value),a.onclick=()=>Ot(-1),r.onclick=()=>Ot(1),s&&(s.onclick=()=>we().catch(console.error)),i&&(i.onclick=()=>$e(pt).catch(console.error)),$&&($.onclick=()=>bt("pending")),w&&(w.onclick=()=>bt("settled")),V&&(V.onclick=()=>Ft("american")),x&&(x.onclick=()=>Ft("decimal")),I&&(I.onclick=()=>Se()),P&&(P.onclick=()=>Be()),T&&(T.onclick=()=>Ce()),X&&(X.onclick=()=>Ee()),K&&(K.onclick=()=>_e()),ct&&(ct.onclick=()=>De()),await vt(pt),_&&(_.textContent="Select a stake and deal."),A&&(A.textContent="Choose a color and spin.");function Ot(n){if(n>0&&!L&&((D==null?void 0:D.games.length)||0)>0){window.alert("Simulate the current day before advancing.");return}const o=e.value||pt,c=new Date(o);c.setDate(c.getDate()+n),Rt(c.toISOString().slice(0,10))}async function $e(n){if(!window.confirm("Reset to season start? Current progress will remain but you will jump back to the first day."))return;const c=1e3;S=await dt({currentDate:n,bankroll:c,initialBankroll:c,pendingStake:0,pendingPotential:0}),e.value=n,B=[],L=!1,D=void 0,Z.clear(),U=[],tt=[],C={available:c,pending_stake:0,pending_potential:0},ft="pending",O="",d=null,Y=[],Q=0,_&&(_.textContent="Select a stake and deal."),W&&(W.value="10"),A&&(A.textContent="Choose a color and spin."),R&&(R.value="10"),M(),await nn(),await an(),await sn(),await on(),mt(),await vt(n)}function bt(n){ft=n,$&&$.classList.toggle("active",n==="pending"),w&&w.classList.toggle("active",n==="settled"),y&&y.classList.toggle("hidden",n!=="pending"),v&&v.classList.toggle("hidden",n!=="settled")}function Ft(n){it!==n&&(it=n,V&&V.classList.toggle("active",n==="american"),x&&x.classList.toggle("active",n==="decimal"),mt(),M())}function wt(n){if(n||(n=et),!l)return;if(!n){l.textContent="";return}const o=new Date(`${n}T00:00:00`);Number.isNaN(o.getTime())?l.textContent=n:l.textContent=o.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric",year:"numeric"})}async function qt(){if(!(g!=null&&g.dates)||!g.dates.length){et=S.currentDate,wt(et);return}const n=[...g.dates].sort();for(const o of n){const c=await ae(o);if(!(c!=null&&c.simulated)){et=o,wt(et);return}}et=n[n.length-1],wt(et)}function Se(){if(!W||!_||!I)return;const n=Math.floor(Number(W.value||0));if(!(n>0)){_.textContent="Enter a valid stake.";return}if(n>C.available){_.textContent="Stake exceeds available balance.";return}(!Y.length||Q>=6||Y.length<52)&&(Y=Gt(),Q=0),z(-n),at(b,C);const o=[G(),G()],c=[G(),G()],u={cards:o,bet:n,status:"playing",doubled:!1,split:!1};d={hands:[u],activeHand:0,dealer:c,stake:n,inRound:!0,settled:!1,message:"Hit, Stand, Double, or Split when available."};const p=F(u.cards),m=F(c);if(p.isBlackjack){d.inRound=!1,d.settled=!0,m.isBlackjack?(u.status="settled",u.result="push",d.message="Both you and the dealer have blackjack. Push.",z(n)):(u.status="blackjack",u.result="win",d.message="Blackjack! Paid 3:2.",z(n*2.5)),at(b,C),Q+=1,q();return}if(m.isBlackjack){d.inRound=!1,d.settled=!0,u.status="settled",u.result="lose",d.message="Dealer has blackjack.",Q+=1,q();return}q()}function Be(){if(!d||!d.inRound)return;const n=lt();if(!n)return;n.cards.push(G());const o=F(n.cards);o.total>21?(n.status="bust",n.result="lose",d.message=`Hand ${d.activeHand+1} busts with ${o.total}.`,ht()):o.total===21?(n.status="stood",d.message=`Hand ${d.activeHand+1} shows 21.`,ht()):d.message=`Hand ${d.activeHand+1} totals ${o.total}.`,q()}function Ce(){if(!d||!d.inRound)return;const n=lt();if(!n)return;const o=F(n.cards);n.status="stood",d.message=`Hand ${d.activeHand+1} stands at ${o.total}.`,ht(),q()}function Ee(){if(!d||!d.inRound)return;const n=lt();if(!n||!Wt(n))return;z(-n.bet),at(b,C),n.bet*=2,n.doubled=!0,n.cards.push(G());const o=F(n.cards);o.total>21?(n.status="bust",n.result="lose",d.message=`Hand ${d.activeHand+1} busts with ${o.total}.`):(n.status="stood",d.message=`Hand ${d.activeHand+1} doubles to ${o.total}.`),ht(),q()}function _e(){if(!d||!d.inRound)return;const n=lt();if(!n||!Kt(n))return;if(n.bet>C.available){d.message="Insufficient bankroll to split.",q();return}z(-n.bet),at(b,C);const[o,c]=n.cards;n.cards=[o,G()],n.status="playing",n.split=!0;const u={cards:[c,G()],bet:n.bet,status:"playing",doubled:!1,split:!0};d.hands.splice(d.activeHand+1,0,u),d.message="Hands split. Play the first hand.",q()}function ht(){if(!d)return;const n=d,o=n.activeHand,c=n.hands.findIndex((p,m)=>m>o&&p.status==="playing");if(c!==-1){n.activeHand=c;return}const u=n.hands.findIndex(p=>p.status==="playing");if(u!==-1){n.activeHand=u;return}n.inRound=!1,xe()}function xe(){if(!d)return;const n=d;if(!n.hands.filter(u=>u.status!=="bust").length){Vt();return}let c=F(n.dealer);for(;c.total<17||c.total===17&&c.isSoft;)n.dealer.push(G()),c=F(n.dealer);Vt()}function Vt(){if(!d)return;const n=d,o=F(n.dealer),c=[];let u=0;n.hands.forEach((p,m)=>{const h=F(p.cards);if(p.status==="bust"){p.result="lose",p.status="settled",c.push(`Hand ${m+1} busts (${h.total}).`);return}const E=!p.split&&p.cards.length===2&&h.isBlackjack;if(o.total>21){p.result="win",p.status=E?"blackjack":"settled",E?c.push(`Hand ${m+1} blackjack! Dealer busts. Paid 3:2.`):c.push(`Hand ${m+1} wins ${h.total} vs dealer bust.`),u+=p.bet*(E?2.5:2);return}h.total>o.total?(p.result="win",p.status=E?"blackjack":"settled",E?c.push(`Hand ${m+1} blackjack beats dealer ${o.total}. Paid 3:2.`):c.push(`Hand ${m+1} wins ${h.total} to ${o.total}.`),u+=p.bet*(E?2.5:2)):h.total<o.total?(p.result="lose",p.status="settled",c.push(`Hand ${m+1} loses ${h.total} to ${o.total}.`)):(p.result="push",p.status="settled",c.push(`Hand ${m+1} pushes at ${h.total}.`),u+=p.bet)}),d.message=c.join("<br/>"),d.settled=!0,d.inRound=!1,d.activeHand=-1,Q+=1,Q>=6&&(Y=[],Q=0),u!==0&&(z(u),at(b,C)),q()}function q(){if(!_||!I||!P||!T||!X||!K)return;const n=document.getElementById("blackjack-dealer-cards"),o=document.getElementById("blackjack-dealer-meta"),c=document.getElementById("blackjack-player-hands"),u=document.getElementById("blackjack-message");if(!d){_.textContent="Select a stake and deal.",I.disabled=!1,P.disabled=!0,T.disabled=!0,X.disabled=!0,K.disabled=!0,n&&(n.textContent="—"),o&&(o.textContent=""),c&&(c.innerHTML='<p class="muted">No active hands.</p>'),u&&(u.textContent="",u.classList.add("muted"));return}const p=lt(),m=!!(d.inRound&&p);I.disabled=d.inRound,P.disabled=!m,T.disabled=!m,X.disabled=!m||!p||!Wt(p),K.disabled=!m||!p||!Kt(p);const h=!d.inRound||d.settled,E=F(d.dealer);n&&(n.textContent=Jt(d.dealer,h)),o&&(o.textContent=h?`Total: ${E.total}${E.isSoft?" (soft)":""}`:"Total: ?",o.classList.toggle("muted",!h)),c&&(c.innerHTML="",d.hands.forEach((H,yt)=>{const nt=document.createElement("div"),$t=["blackjack-hand"];d.activeHand===yt&&d.inRound&&$t.push("active"),H.status==="bust"&&$t.push("bust"),nt.className=$t.join(" ");const St=document.createElement("div");St.className="blackjack-cards",St.textContent=Jt(H.cards,!0),nt.appendChild(St);const Bt=document.createElement("div");Bt.className="blackjack-hand-meta";const zt=F(H.cards),je=[`Total: ${zt.total}`,zt.isSoft?"Soft":"",H.doubled?"Doubled":"",H.split?"Split":""].filter(Boolean);if(Bt.textContent=je.join(" • "),nt.appendChild(Bt),H.result||H.status==="blackjack"){const Ct=document.createElement("div"),Yt=H.status==="blackjack"?"blackjack":H.result??"win";Ct.className=`blackjack-hand-result ${Yt}`,Ct.textContent=H.status==="blackjack"?"BLACKJACK":Yt.toUpperCase(),nt.appendChild(Ct)}c.appendChild(nt)})),_.textContent=d.inRound?"Your move.":"Round complete.",u&&(d.message?(u.innerHTML=d.message,u.classList.remove("muted")):(u.textContent="",u.classList.add("muted")))}function De(){if(!R||!rt||!A)return;const n=Number(R.value||0);if(!(n>0)){A.textContent="Enter a valid stake.";return}if(n>C.available){A.textContent="Stake exceeds available balance.";return}const o=rt.value||"red",c=Math.floor(Math.random()*37),u=c===0?"green":c%2===0?"black":"red";if(o===u){const m=n*(o==="green"?35:1);A.textContent=`Ball landed ${u.toUpperCase()} (${c}). You win ${J(m)}!`,z(m)}else A.textContent=`Ball landed ${u.toUpperCase()} (${c}). You lose ${J(n)}.`,z(-n);at(b,C)}function lt(){if(!d)return null;const n=d.activeHand;return n<0||n>=d.hands.length?null:d.hands[n]}function Wt(n){return!(!(d!=null&&d.inRound)||n.status!=="playing"||n.cards.length!==2||n.doubled||C.available<n.bet)}function Kt(n){if(!(d!=null&&d.inRound)||n.status!=="playing"||n.cards.length!==2||n.split||C.available<n.bet)return!1;const[o,c]=n.cards;return Ut(o)===Ut(c)}function Ut(n){return n?n.startsWith("10")?"10":n.charAt(0):""}function Gt(n=6){const o=[];for(let c=0;c<n;c+=1)o.push(...Le());for(let c=o.length-1;c>0;c-=1){const u=Math.floor(Math.random()*(c+1));[o[c],o[u]]=[o[u],o[c]]}return o}function Le(){const n=[];for(const o of Nn)for(const c of In)n.push(`${o}${c}`);return n}function G(){return Y.length||(Y=Gt()),Y.pop()??"??"}function F(n){let o=0,c=0;for(const m of n){const h=m.startsWith("10")?"10":m.charAt(0);h==="A"?(c+=1,o+=11):["K","Q","J"].includes(h)||h==="10"?o+=10:o+=Number(h)}let u=c;for(;o>21&&u>0;)o-=10,u-=1;const p=n.length===2&&o===21;return{total:o,isSoft:c>u,bust:o>21,isBlackjack:p}}function Jt(n,o){return n.length?o?n.join(" "):`${n[0]} ??`:""}}Tn();
